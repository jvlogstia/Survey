<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>SurveyCraft Pro | Connect</title>
  
  <!-- Tailwind -->
  <script src="https://cdn.tailwindcss.com"></script>
  
  <!-- Icons -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" />
  
  <!-- Charts -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
  
  <!-- Flag Icons -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/lipis/flag-icons@6.6.6/css/flag-icons.min.css" />

  <style>
    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');
    
    :root {
      --primary: #6366f1;
      --primary-dark: #4f46e5;
      --accent: #a855f7;
      --accent-dark: #9333ea;
      --security: #22c55e;
      --security-dark: #16a34a;
      --ink-light: #e5e7eb;
      --ink-medium: #64748b;
      --ink-dark: #1e293b;
    }
    
    * { box-sizing: border-box; }
    
    body {
      font-family: 'Inter', sans-serif;
      background: #0b1020;
      color: var(--ink-light);
      overflow-x: hidden;
    }
    
    /* Animations */
    @keyframes float {
      0%, 100% { transform: translateY(0) translateX(0); }
      50% { transform: translateY(-8px) translateX(4px); }
    }
    
    @keyframes shimmer {
      0% { background-position: 200% 0; }
      100% { background-position: -200% 0; }
    }
    
    @keyframes pulse-glow {
      0%, 100% { box-shadow: 0 0 5px rgba(99, 102, 241, 0.5); }
      50% { box-shadow: 0 0 20px rgba(99, 102, 241, 0.8); }
    }
    
    @keyframes slide-in {
      from { transform: translateX(-100%); opacity: 0; }
      to { transform: translateX(0); opacity: 1; }
    }
    
    @keyframes fade-in-up {
      from { transform: translateY(20px); opacity: 0; }
      to { transform: translateY(0); opacity: 1; }
    }
    
    @keyframes ripple {
      0% { transform: scale(0); opacity: 1; }
      100% { transform: scale(4); opacity: 0; }
    }
    
    @keyframes particle-float {
      0% { transform: translateY(0) rotate(0deg); opacity: 0; }
      10% { opacity: 1; }
      90% { opacity: 1; }
      100% { transform: translateY(-100px) rotate(360deg); opacity: 0; }
    }
    
    @keyframes security-pulse {
      0%, 100% { 
        box-shadow: 0 0 0 0 rgba(34, 197, 94, 0.7);
        transform: scale(1);
      }
      50% { 
        box-shadow: 0 0 0 10px rgba(34, 197, 94, 0);
        transform: scale(1.05);
      }
    }
    
    /* Base Styles */
    .glass {
      backdrop-filter: blur(16px) saturate(160%);
      background: rgba(17, 24, 39, 0.66);
      border: 1px solid rgba(255, 255, 255, 0.08);
    }
    
    .card {
      background: rgba(17, 24, 39, 0.78);
      border: 1px solid rgba(255, 255, 255, 0.08);
      border-radius: 16px;
      transition: all 0.3s ease;
      position: relative;
      overflow: hidden;
    }
    
    .card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: radial-gradient(circle at var(--mouse-x, 50%) var(--mouse-y, 50%), rgba(99, 102, 241, 0.15), transparent 40%);
      opacity: 0;
      transition: opacity 0.3s;
      pointer-events: none;
    }
    
    .card:hover::before {
      opacity: 1;
    }
    
    .card:hover {
      transform: translateY(-5px);
      box-shadow: 0 15px 40px rgba(0, 0, 0, 0.3);
      border-color: rgba(99, 102, 241, 0.4);
    }
    
    .field {
      background: rgba(255, 255, 255, 0.06);
      border: 1px solid transparent;
      border-radius: 12px;
      padding: 0.75rem 1rem;
      transition: all 0.2s;
      color: var(--ink-light);
    }
    
    .field:focus {
      outline: none;
      border-color: rgba(99, 102, 241, 0.6);
      box-shadow: 0 0 0 4px rgba(99, 102, 241, 0.2);
      background: rgba(255, 255, 255, 0.08);
    }
    
    .btn {
      position: relative;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 0.5rem;
      border-radius: 12px;
      padding: 0.75rem 1rem;
      font-weight: 600;
      transition: all 0.2s;
      cursor: pointer;
      overflow: hidden;
      z-index: 1;
    }
    
    .btn::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
      transition: left 0.5s;
      z-index: -1;
    }
    
    .btn:hover::before {
      left: 100%;
    }
    
    .btn-primary {
      background: linear-gradient(90deg, var(--primary), var(--accent));
      color: white;
    }
    
    .btn-primary:hover {
      transform: translateY(-2px);
      box-shadow: 0 10px 30px rgba(99, 102, 241, 0.3);
    }
    
    .btn-ghost {
      background: rgba(255, 255, 255, 0.04);
      color: var(--ink-light);
      border: 1px solid rgba(255, 255, 255, 0.08);
    }
    
    .btn-ghost:hover {
      background: rgba(255, 255, 255, 0.06);
      transform: translateY(-1px);
    }
    
    .btn-security {
      background: linear-gradient(90deg, var(--security), var(--security-dark));
      color: white;
    }
    
    .btn-security:hover {
      transform: translateY(-2px);
      box-shadow: 0 10px 30px rgba(34, 197, 94, 0.3);
    }
    
    .nav-item {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      padding: 0.75rem 0.9rem;
      border-radius: 12px;
      color: var(--ink-light);
      transition: all 0.2s;
      position: relative;
      overflow: hidden;
    }
    
    .nav-item::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      width: 4px;
      height: 100%;
      background: linear-gradient(to bottom, var(--primary), var(--accent));
      transform: scaleY(0);
      transition: transform 0.3s ease;
    }
    
    .nav-item:hover {
      background: rgba(99, 102, 241, 0.12);
    }
    
    .nav-item:hover::before {
      transform: scaleY(1);
    }
    
    .nav-item.active {
      background: rgba(99, 102, 241, 0.18);
      color: #c7d2fe;
    }
    
    .nav-item.active::before {
      transform: scaleY(1);
    }
    
    .badge {
      border-radius: 9999px;
      padding: 0.35rem 0.6rem;
      font-size: 0.75rem;
      border: 1px solid rgba(255, 255, 255, 0.14);
      background: rgba(255, 255, 255, 0.05);
    }
    
    .badge-security {
      background: rgba(34, 197, 94, 0.15);
      border-color: rgba(34, 197, 94, 0.3);
      color: #86efac;
    }
    
    .status-active {
      background: rgba(34, 197, 94, 0.15);
      color: #86efac;
    }
    
    .status-draft {
      background: rgba(107, 114, 128, 0.15);
      color: #d1d5db;
    }
    
    .status-closed {
      background: rgba(239, 68, 68, 0.15);
      color: #fca5a5;
    }
    
    .status-archived {
      background: rgba(156, 163, 175, 0.15);
      color: #e5e7eb;
    }
    
    .modal {
      position: fixed;
      inset: 0;
      background: rgba(0, 0, 0, 0.7);
      backdrop-filter: blur(4px);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 50;
      padding: 1rem;
      animation: fade-in-up 0.3s ease-out;
    }
    
    .modal-content {
      max-width: 32rem;
      width: 100%;
      max-height: 90vh;
      overflow-y: auto;
      animation: slide-in 0.3s ease-out;
      position: relative;
    }
    
    .progress-bar {
      height: 6px;
      border-radius: 3px;
      background: rgba(255, 255, 255, 0.1);
      overflow: hidden;
    }
    
    .progress-fill {
      height: 100%;
      border-radius: 3px;
      background: linear-gradient(90deg, var(--primary), var(--accent));
      animation: shimmer 2s linear infinite;
    }
    
    .empty {
      border: 1px dashed rgba(255, 255, 255, 0.18);
      background: rgba(255, 255, 255, 0.03);
      border-radius: 16px;
      padding: 2rem;
      text-align: center;
    }
    
    /* Toggle Switch */
    .toggle-switch {
      position: relative;
      display: inline-block;
      width: 48px;
      height: 24px;
      background-color: rgba(255, 255, 255, 0.1);
      border-radius: 24px;
      cursor: pointer;
      transition: background-color 0.3s;
    }
    
    .toggle-switch::after {
      content: '';
      position: absolute;
      width: 18px;
      height: 18px;
      border-radius: 50%;
      background-color: white;
      top: 3px;
      left: 3px;
      transition: transform 0.3s;
    }
    
    .toggle-switch:checked {
      background-color: var(--primary);
    }
    
    .toggle-switch:checked::after {
      transform: translateX(24px);
    }
    
    /* Drag & Drop Styles - Enhanced */
    .component-item {
      padding: 0.75rem;
      background: rgba(255, 255, 255, 0.05);
      border-radius: 0.5rem;
      margin-bottom: 0.75rem;
      cursor: grab;
      transition: all 0.2s;
      border: 1px solid rgba(255, 255, 255, 0.1);
      position: relative;
      overflow: hidden;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }
    
    .component-item::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: radial-gradient(circle at center, rgba(99, 102, 241, 0.2), transparent 70%);
      opacity: 0;
      transition: opacity 0.3s;
    }
    
    .component-item:hover {
      background: rgba(99, 102, 241, 0.15);
      border-color: rgba(99, 102, 241, 0.4);
      transform: translateY(-3px);
    }
    
    .component-item:hover::before {
      opacity: 1;
    }
    
    .component-item:active {
      cursor: grabbing;
    }
    
    .component-item i {
      color: var(--primary);
    }
    
    /* Enhanced Builder Layout */
    .builder-container {
      display: flex;
      flex-direction: row;
      height: calc(100vh - 180px);
      gap: 1.5rem;
    }
    
    .components-panel {
      width: 320px;
      flex-shrink: 0;
      overflow-y: auto;
      padding: 1.5rem;
      background: rgba(17, 24, 39, 0.6);
      border-radius: 16px;
      border: 1px solid rgba(255, 255, 255, 0.08);
    }
    
    .components-panel h3 {
      font-size: 1.125rem;
      font-weight: 600;
      margin-bottom: 1rem;
      color: var(--ink-light);
    }
    
    .components-panel p {
      color: var(--ink-medium);
      font-size: 0.875rem;
      margin-bottom: 1.5rem;
    }
    
    .canvas-panel {
      flex-grow: 1;
      overflow-y: auto;
      padding: 1.5rem;
      background: rgba(17, 24, 39, 0.6);
      border-radius: 16px;
      border: 1px solid rgba(255, 255, 255, 0.08);
    }
    
    .canvas-panel h3 {
      font-size: 1.125rem;
      font-weight: 600;
      margin-bottom: 1rem;
      color: var(--ink-light);
    }
    
    .canvas-area {
      min-height: 400px;
      background: rgba(255, 255, 255, 0.03);
      border: 2px dashed rgba(255, 255, 255, 0.1);
      border-radius: 0.75rem;
      padding: 1.5rem;
      transition: all 0.3s;
      position: relative;
    }
    
    .canvas-area.drag-over {
      background: rgba(99, 102, 241, 0.05);
      border-color: rgba(99, 102, 241, 0.5);
    }
    
    .canvas-item {
      background: rgba(17, 24, 39, 0.9);
      border: 1px solid rgba(255, 255, 255, 0.1);
      border-radius: 0.5rem;
      padding: 1rem;
      margin-bottom: 1rem;
      position: relative;
      transition: all 0.2s;
      animation: fade-in-up 0.3s ease-out;
      cursor: move;
    }
    
    .canvas-item:hover {
      border-color: rgba(99, 102, 241, 0.4);
      transform: translateY(-2px);
    }
    
    .canvas-item.selected {
      border-color: rgba(99, 102, 241, 0.8);
      box-shadow: 0 0 0 2px rgba(99, 102, 241, 0.3);
    }
    
    .canvas-item.editing {
      border-color: rgba(99, 102, 241, 0.8);
      box-shadow: 0 0 0 2px rgba(99, 102, 241, 0.3);
    }
    
    .canvas-item.dragging {
      opacity: 0.5;
      transform: scale(0.95);
    }
    
    .canvas-item .item-controls {
      position: absolute;
      top: 0.5rem;
      right: 0.5rem;
      display: flex;
      gap: 0.5rem;
      opacity: 0;
      transition: opacity 0.2s;
      z-index: 10;
    }
    
    .canvas-item:hover .item-controls {
      opacity: 1;
    }
    
    .canvas-item.editing .item-controls {
      opacity: 1;
    }
    
    .canvas-item .control-btn {
      width: 24px;
      height: 24px;
      border-radius: 4px;
      display: flex;
      align-items: center;
      justify-content: center;
      background: rgba(255, 255, 255, 0.1);
      cursor: pointer;
      transition: all 0.2s;
    }
    
    .canvas-item .control-btn:hover {
      background: rgba(255, 255, 255, 0.2);
      transform: scale(1.1);
    }
    
    .drop-zone {
      border: 2px dashed rgba(99, 102, 241, 0.5);
      background: rgba(99, 102, 241, 0.05);
      border-radius: 0.5rem;
      padding: 1.5rem;
      text-align: center;
      margin-bottom: 1rem;
      transition: all 0.3s;
    }
    
    .drop-zone.active {
      background: rgba(99, 102, 241, 0.1);
      border-color: rgba(99, 102, 241, 0.8);
      animation: pulse-glow 1.5s infinite;
    }
    
    .drop-placeholder {
      height: 2px;
      background: var(--primary);
      margin: 0.5rem 0;
      border-radius: 1px;
      transition: all 0.2s;
    }
    
    .drop-placeholder.active {
      height: 4px;
      box-shadow: 0 0 8px rgba(99, 102, 241, 0.6);
    }
    
    /* Edit Question Modal Styles */
    .edit-question-form {
      display: flex;
      flex-direction: column;
      gap: 1rem;
    }
    
    .edit-question-form .form-group {
      display: flex;
      flex-direction: column;
      gap: 0.5rem;
    }
    
    .edit-question-form .form-group label {
      font-weight: 500;
      font-size: 0.875rem;
    }
    
    .edit-question-form .form-group input,
    .edit-question-form .form-group textarea,
    .edit-question-form .form-group select {
      background: rgba(255, 255, 255, 0.06);
      border: 1px solid rgba(255, 255, 255, 0.1);
      border-radius: 8px;
      padding: 0.5rem;
      color: var(--ink-light);
      transition: all 0.2s;
    }
    
    .edit-question-form .form-group input:focus,
    .edit-question-form .form-group textarea:focus,
    .edit-question-form .form-group select:focus {
      outline: none;
      border-color: rgba(99, 102, 241, 0.6);
      background: rgba(255, 255, 255, 0.08);
    }
    
    .edit-question-form .options-list {
      display: flex;
      flex-direction: column;
      gap: 0.5rem;
      max-height: 200px;
      overflow-y: auto;
      padding: 0.5rem;
      background: rgba(255, 255, 255, 0.03);
      border-radius: 8px;
    }
    
    .edit-question-form .option-item {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      padding: 0.5rem;
      background: rgba(255, 255, 255, 0.05);
      border-radius: 6px;
    }
    
    .edit-question-form .option-item input {
      flex: 1;
      background: transparent;
      border: none;
      padding: 0.25rem;
    }
    
    .edit-question-form .option-item button {
      background: rgba(255, 255, 255, 0.1);
      border: none;
      border-radius: 4px;
      width: 28px;
      height: 28px;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: all 0.2s;
    }
    
    .edit-question-form .option-item button:hover {
      background: rgba(239, 68, 68, 0.2);
      color: #fca5a5;
    }
    
    .edit-question-form .add-option-btn {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 0.5rem;
      padding: 0.5rem;
      background: rgba(99, 102, 241, 0.1);
      border: 1px dashed rgba(99, 102, 241, 0.3);
      border-radius: 6px;
      color: #a5b4fc;
      cursor: pointer;
      transition: all 0.2s;
      margin-top: 0.5rem;
    }
    
    .edit-question-form .add-option-btn:hover {
      background: rgba(99, 102, 241, 0.2);
      border-color: rgba(99, 102, 241, 0.5);
    }
    
    .edit-question-form .form-actions {
      display: flex;
      justify-content: flex-end;
      gap: 0.75rem;
      margin-top: 1rem;
      padding-top: 1rem;
      border-top: 1px solid rgba(255, 255, 255, 0.1);
    }
    
    /* Survey Card Styles */
    .survey-card {
      background: rgba(17, 24, 39, 0.78);
      border: 1px solid rgba(255, 255, 255, 0.08);
      border-radius: 16px;
      padding: 1.5rem;
      transition: all 0.3s ease;
      cursor: pointer;
      position: relative;
      overflow: hidden;
    }
    
    .survey-card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 4px;
      background: linear-gradient(90deg, var(--primary), var(--accent));
      transform: scaleX(0);
      transform-origin: left;
      transition: transform 0.3s ease;
    }
    
    .survey-card:hover::before {
      transform: scaleX(1);
    }
    
    .survey-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 15px 40px rgba(0, 0, 0, 0.3);
      border-color: rgba(99, 102, 241, 0.4);
    }
    
    .survey-card-header {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      margin-bottom: 1rem;
    }
    
    .survey-card-title {
      font-size: 1.125rem;
      font-weight: 600;
      margin-bottom: 0.25rem;
    }
    
    .survey-card-meta {
      display: flex;
      align-items: center;
      gap: 1rem;
      margin-top: 0.5rem;
      font-size: 0.875rem;
      color: rgba(229, 231, 235, 0.7);
    }
    
    .survey-card-actions {
      display: flex;
      gap: 0.5rem;
    }
    
    .survey-card-actions .btn {
      padding: 0.5rem;
      font-size: 0.875rem;
    }
    
    .survey-status {
      display: inline-flex;
      align-items: center;
      gap: 0.25rem;
      padding: 0.25rem 0.5rem;
      border-radius: 9999px;
      font-size: 0.75rem;
      font-weight: 500;
    }
    
    .survey-progress {
      height: 4px;
      background-color: rgba(255, 255, 255, 0.1);
      border-radius: 2px;
      overflow: hidden;
      margin-top: 1rem;
    }
    
    .survey-progress-bar {
      height: 100%;
      border-radius: 2px;
      background: linear-gradient(90deg, var(--primary), var(--accent));
    }
    
    /* Question Card Styles */
    .question-card {
      background: rgba(17, 24, 39, 0.78);
      border: 1px solid rgba(255, 255, 255, 0.08);
      border-radius: 16px;
      padding: 1.5rem;
      margin-bottom: 1.5rem;
      transition: all 0.3s ease;
      position: relative;
    }
    
    .question-card::after {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      width: 4px;
      height: 100%;
      background: linear-gradient(to bottom, var(--primary), var(--accent));
      border-radius: 4px 0 0 4px;
      transform: scaleY(0);
      transform-origin: top;
      transition: transform 0.3s ease;
    }
    
    .question-card:hover::after {
      transform: scaleY(1);
    }
    
    .question-card:hover {
      border-color: rgba(99, 102, 241, 0.4);
    }
    
    .question-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 1rem;
    }
    
    .question-number {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      width: 28px;
      height: 28px;
      border-radius: 50%;
      background: rgba(99, 102, 241, 0.2);
      color: #c7d2fe;
      font-weight: 600;
      font-size: 0.875rem;
    }
    
    .question-type-badge {
      display: inline-flex;
      align-items: center;
      gap: 0.35rem;
      padding: 0.25rem 0.5rem;
      border-radius: 9999px;
      font-size: 0.75rem;
      background: rgba(99, 102, 241, 0.15);
      color: #a5b4fc;
    }
    
    .question-content {
      margin-bottom: 1rem;
    }
    
    .question-text {
      font-size: 1.125rem;
      font-weight: 500;
      margin-bottom: 0.5rem;
    }
    
    .question-description {
      font-size: 0.875rem;
      color: rgba(229, 231, 235, 0.7);
    }
    
    .question-options {
      margin-top: 1rem;
    }
    
    .option-item {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      padding: 0.75rem;
      border-radius: 8px;
      background: rgba(255, 255, 255, 0.03);
      margin-bottom: 0.5rem;
      transition: all 0.2s;
    }
    
    .option-item:hover {
      background: rgba(255, 255, 255, 0.06);
      transform: translateX(4px);
    }
    
    .option-item input[type="radio"],
    .option-item input[type="checkbox"] {
      width: 18px;
      height: 18px;
      accent-color: var(--primary);
    }
    
    .option-text {
      flex: 1;
    }
    
    .question-actions {
      display: flex;
      justify-content: flex-end;
      gap: 0.5rem;
      margin-top: 1rem;
    }
    
    .question-actions .btn {
      padding: 0.5rem 0.75rem;
      font-size: 0.875rem;
    }
    
    /* Password Strength Meter */
    .password-strength-meter {
      height: 4px;
      background: rgba(255, 255, 255, 0.1);
      border-radius: 2px;
      margin-top: 0.5rem;
      overflow: hidden;
    }
    
    .password-strength-fill {
      height: 100%;
      border-radius: 2px;
      transition: width 0.3s, background-color 0.3s;
    }
    
    .strength-weak {
      width: 33%;
      background-color: #ef4444;
    }
    
    .strength-medium {
      width: 66%;
      background-color: #f59e0b;
    }
    
    .strength-strong {
      width: 100%;
      background-color: #22c55e;
    }
    
    /* Security Badge */
    .security-badge {
      display: inline-flex;
      align-items: center;
      gap: 0.5rem;
      padding: 0.5rem 1rem;
      border-radius: 9999px;
      background: rgba(34, 197, 94, 0.15);
      color: #86efac;
      font-weight: 500;
      animation: security-pulse 2s infinite;
    }
    
    /* Particle Background */
    .particles {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      pointer-events: none;
      overflow: hidden;
      z-index: -1;
    }
    
    .particle {
      position: absolute;
      width: 4px;
      height: 4px;
      background: rgba(99, 102, 241, 0.5);
      border-radius: 50%;
      animation: particle-float 10s linear infinite;
    }
    
    /* Ripple Effect */
    .ripple {
      position: absolute;
      border-radius: 50%;
      background: rgba(255, 255, 255, 0.3);
      transform: scale(0);
      animation: ripple 0.6s linear;
      pointer-events: none;
    }
    
    /* Loading Animation */
    .loader {
      width: 48px;
      height: 48px;
      border: 5px solid rgba(99, 102, 241, 0.2);
      border-radius: 50%;
      border-top-color: var(--primary);
      animation: spin 1s ease-in-out infinite;
    }
    
    @keyframes spin {
      to { transform: rotate(360deg); }
    }
    
    /* Glow Effect */
    .glow {
      animation: pulse-glow 2s infinite;
    }
    
    /* Floating Animation */
    .float {
      animation: float 6s ease-in-out infinite;
    }
    
    /* Shimmer Effect */
    .shimmer {
      background: linear-gradient(90deg, rgba(255,255,255,0) 0%, rgba(255,255,255,0.2) 50%, rgba(255,255,255,0) 100%);
      background-size: 200% 100%;
      animation: shimmer 2s linear infinite;
    }
    
    /* Responsive improvements */
    @media (max-width: 768px) {
      .builder-container { 
        flex-direction: column; 
        height: auto;
        gap: 1rem;
      }
      .components-panel { 
        width: 100%; 
        margin-bottom: 0;
      }
      .filter-bar { flex-direction: column; gap: 0.5rem; }
      .survey-card { padding: 1rem; }
      .survey-card-header { flex-direction: column; gap: 0.5rem; }
      .survey-card-actions { align-self: flex-end; }
      .question-card { padding: 1rem; }
      .edit-question-modal .modal-content { max-width: 90%; }
    }
    
    /* Page Transition */
    .page-transition {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: #0b1020;
      z-index: 9999;
      transform: translateY(100%);
      transition: transform 0.5s ease-in-out;
    }
    
    .page-transition.active {
      transform: translateY(0);
    }
    
    /* Drag Ghost Image */
    .drag-ghost {
      opacity: 0.5;
      background: rgba(99, 102, 241, 0.2);
      border: 2px dashed rgba(99, 102, 241, 0.5);
      border-radius: 8px;
      padding: 0.75rem;
    }
    
    /* Security Lock Animation */
    @keyframes lock {
      0%, 100% { transform: rotate(0deg); }
      25% { transform: rotate(-10deg); }
      75% { transform: rotate(10deg); }
    }
    
    .security-lock {
      animation: lock 0.5s ease-in-out;
    }
    
    /* Rating Stars */
    .rating-container {
      display: flex;
      gap: 0.5rem;
      margin-top: 0.5rem;
    }
    
    .rating-star {
      cursor: pointer;
      transition: color 0.2s;
    }
    
    .rating-star:hover {
      color: #fbbf24;
    }
    
    .rating-star.active {
      color: #fbbf24;
    }
    
    /* Scale Container */
    .scale-container {
      display: flex;
      justify-content: space-between;
      margin-top: 0.5rem;
    }
    
    .scale-point {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 0.25rem;
    }
    
    .scale-label {
      font-size: 0.75rem;
      color: rgba(229, 231, 235, 0.7);
    }
    
    /* Enhanced Builder Toolbar */
    .builder-toolbar {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 1rem;
      padding-bottom: 1rem;
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    }
    
    .builder-title {
      font-size: 1.25rem;
      font-weight: 600;
    }
    
    .builder-actions {
      display: flex;
      gap: 0.75rem;
    }
    
    /* Component Categories */
    .component-category {
      margin-bottom: 1.5rem;
    }
    
    .component-category-title {
      font-size: 0.875rem;
      font-weight: 600;
      color: var(--ink-medium);
      margin-bottom: 0.75rem;
      text-transform: uppercase;
      letter-spacing: 0.05em;
    }
    
    /* Component Search */
    .component-search {
      position: relative;
      margin-bottom: 1.5rem;
    }
    
    .component-search input {
      width: 100%;
      padding-left: 2.5rem;
    }
    
    .component-search i {
      position: absolute;
      left: 0.75rem;
      top: 50%;
      transform: translateY(-50%);
      color: var(--ink-medium);
    }
    
    /* Question Settings Panel */
    .question-settings {
      position: fixed;
      right: 0;
      top: 0;
      width: 320px;
      height: 100%;
      background: rgba(17, 24, 39, 0.95);
      border-left: 1px solid rgba(255, 255, 255, 0.1);
      padding: 1.5rem;
      overflow-y: auto;
      transform: translateX(100%);
      transition: transform 0.3s ease;
      z-index: 40;
    }
    
    .question-settings.active {
      transform: translateX(0);
    }
    
    .settings-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 1.5rem;
    }
    
    .settings-title {
      font-size: 1.125rem;
      font-weight: 600;
    }
    
    .settings-close {
      width: 32px;
      height: 32px;
      border-radius: 8px;
      display: flex;
      align-items: center;
      justify-content: center;
      background: rgba(255, 255, 255, 0.1);
      cursor: pointer;
      transition: all 0.2s;
    }
    
    .settings-close:hover {
      background: rgba(255, 255, 255, 0.2);
    }
    
    .settings-section {
      margin-bottom: 1.5rem;
    }
    
    .settings-section-title {
      font-size: 0.875rem;
      font-weight: 600;
      margin-bottom: 0.75rem;
    }
    
    .settings-option {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 0.75rem 0;
      border-bottom: 1px solid rgba(255, 255, 255, 0.05);
    }
    
    .settings-option:last-child {
      border-bottom: none;
    }
    
    .settings-option-label {
      font-size: 0.875rem;
    }
    
    /* Responsive adjustments for builder */
    @media (max-width: 1024px) {
      .question-settings {
        width: 100%;
      }
    }
  </style>
</head>
<body>
  <!-- Particle Background -->
  <div class="particles" id="particles"></div>
  
  <!-- Page Transition -->
  <div class="page-transition" id="page-transition"></div>
  
  <!-- Top gradient sheen -->
  <div class="pointer-events-none fixed inset-x-0 -top-24 h-48 bg-gradient-to-b from-primary-500/20 to-transparent blur-3xl"></div>

  <!-- AUTH -->
  <section id="auth" class="min-h-screen grid place-items-center p-6">
    <div class="auth card w-full max-w-lg p-8 shadow-glow animate-fade-up">
      <div class="w-14 h-14 rounded-2xl bg-gradient-to-br from-primary-500 to-accent-500 grid place-items-center mb-5 float">
        <i class="fa-solid fa-link text-white"></i>
      </div>
      <h1 class="text-2xl font-semibold">Connect to SurveyCraft Pro</h1>
      <p class="text-ink-400 mt-1">Sign in to continue.</p>

      <div class="mt-6 grid grid-cols-2 gap-2 bg-white/5 p-1 rounded-xl">
        <button id="tab-login" class="tab btn-ghost py-2 rounded-lg data-[active=true]:bg-primary-500/20" data-active="true">Login</button>
        <button id="tab-signup" class="tab btn-ghost py-2 rounded-lg">Sign Up</button>
      </div>

      <!-- Login -->
      <form id="form-login" class="mt-6 space-y-4" autocomplete="on">
        <label class="block">
          <span class="block text-sm mb-1">Email</span>
          <input type="email" name="email" class="field w-full" placeholder="you@company.com" required />
        </label>
        <label class="block">
          <span class="block text-sm mb-1">Password</span>
          <input type="password" name="password" id="login-password" class="field w-full" placeholder="••••••••" minlength="8" required />
          <div class="password-strength-meter">
            <div class="password-strength-fill" id="password-strength-fill"></div>
          </div>
          <small id="password-strength" class="text-xs text-ink-400 mt-1">Password strength: Weak</small>
        </label>
        <div class="flex items-center justify-between text-sm">
          <label class="inline-flex items-center gap-2 select-none">
            <input type="checkbox" name="remember" class="accent-primary-500" />
            <span>Remember me</span>
          </label>
          <a href="#" class="text-primary-300 hover:text-primary-200">Forgot password?</a>
        </div>
        <!-- 2FA Option -->
        <label class="block">
          <span class="block text-sm mb-1">Two-Factor Code (if enabled)</span>
          <input type="text" name="2fa" class="field w-full" placeholder="Enter 6-digit code" />
        </label>
        <button type="submit" class="btn btn-primary w-full" id="btn-login">
          <span class="inline-flex items-center gap-2"><i class="fa-solid fa-right-to-bracket"></i> Sign In</span>
        </button>
        <p id="login-error" class="hidden text-red-400 text-sm" role="alert">Authentication failed. Check your credentials.</p>
      </form>
      
      <!-- Signup -->
      <form id="form-signup" class="mt-6 space-y-4 hidden" autocomplete="on">
        <label class="block">
          <span class="block text-sm mb-1">Full name</span>
          <input type="text" name="name" class="field w-full" placeholder="Your name" required />
        </label>
        <label class="block">
          <span class="block text-sm mb-1">Email</span>
          <input type="email" name="email" class="field w-full" placeholder="you@company.com" required />
        </label>
        <label class="block">
          <span class="block text-sm mb-1">Password</span>
          <input type="password" name="password" class="field w-full" placeholder="Create a password" required />
        </label>
        <label class="inline-flex items-center gap-2 text-sm">
          <input type="checkbox" name="terms" required />
          <span>I agree to the terms</span>
        </label>
        <button type="submit" class="btn btn-primary w-full" id="btn-signup">
          <span class="inline-flex items-center gap-2"><i class="fa-solid fa-user-plus"></i> Create Account</span>
        </button>
        <p id="signup-error" class="hidden text-red-400 text-sm" role="alert">Please verify your details.</p>
      </form>
    </div>
  </section>

  <!-- APP SHELL -->
  <section id="app" class="hidden h-screen">
    <div class="h-full flex">
      <!-- Sidebar -->
      <aside class="glass w-72 p-5 hidden md:block">
        <div class="flex items-center gap-3 mb-8">
          <div class="w-10 h-10 rounded-xl bg-gradient-to-br from-primary-500 to-accent-500 grid place-items-center glow">
            <i class="fa-solid fa-link text-white"></i>
          </div>
          <div>
            <h2 class="font-semibold">SurveyCraft Pro</h2>
            <p class="text-xs text-ink-400">Connect</p>
          </div>
        </div>
        <nav class="space-y-1">
          <a href="#" data-route="dashboard" class="nav-item active"><i class="fa-solid fa-gauge-high w-5 text-primary-300"></i><span>Dashboard</span></a>
          <a href="#" data-route="surveys" class="nav-item"><i class="fa-solid fa-square-poll-vertical w-5"></i><span>Surveys</span></a>
          <a href="#" data-route="share" class="nav-item"><i class="fa-solid fa-share-nodes w-5"></i><span>Share</span></a>
          <a href="#" data-route="analytics" class="nav-item"><i class="fa-solid fa-chart-simple w-5"></i><span>Analytics</span></a>
          <a href="#" data-route="audience" class="nav-item"><i class="fa-solid fa-users w-5"></i><span>Audience</span></a>
          <a href="#" data-route="settings" class="nav-item"><i class="fa-solid fa-gear w-5"></i><span>Settings</span></a>
        </nav>
        <div class="mt-10 pt-6 border-t border-white/10">
          <button id="btn-logout" class="btn btn-ghost w-full"><i class="fa-solid fa-right-from-bracket"></i> Logout</button>
        </div>
      </aside>

      <!-- Main -->
      <main class="flex-1 overflow-y-auto p-6">
        <!-- Header -->
        <header class="flex items-center justify-between mb-6">
          <div>
            <h1 class="text-xl font-semibold" id="route-title">Overview</h1>
            <p class="text-ink-400 text-sm" id="route-description">Bring your data — we keep the UI clean.</p>
          </div>
          <div class="flex items-center gap-3">
            <!-- Language Selector -->
            <div class="relative" id="language-selector">
              <button class="btn btn-ghost flex items-center gap-2">
                <span class="fi fi-us rounded-sm" id="current-flag"></span>
                <span id="current-lang">English</span>
                <i class="fa-solid fa-chevron-down text-xs"></i>
              </button>
              <div class="absolute top-full right-0 mt-2 w-48 card p-2 hidden z-10" id="language-dropdown">
                <div class="text-xs text-ink-400 px-2 py-1">Select Language</div>
                <div class="divide-y divide-white/5">
                  <button class="w-full text-left px-3 py-2 rounded-lg hover:bg-white/5 flex items-center gap-2 language-option" data-lang="en">
                    <span class="fi fi-us rounded-sm"></span> English
                  </button>
                  <button class="w-full text-left px-3 py-2 rounded-lg hover:bg-white/5 flex items-center gap-2 language-option" data-lang="es">
                    <span class="fi fi-es rounded-sm"></span> Español
                  </button>
                  <button class="w-full text-left px-3 py-2 rounded-lg hover:bg-white/5 flex items-center gap-2 language-option" data-lang="fr">
                    <span class="fi fi-fr rounded-sm"></span> Français
                  </button>
                  <button class="w-full text-left px-3 py-2 rounded-lg hover:bg-white/5 flex items-center gap-2 language-option" data-lang="de">
                    <span class="fi fi-de rounded-sm"></span> Deutsch
                  </button>
                  <button class="w-full text-left px-3 py-2 rounded-lg hover:bg-white/5 flex items-center gap-2 language-option" data-lang="zh">
                    <span class="fi fi-cn rounded-sm"></span> 中文
                  </button>
                </div>
              </div>
            </div>
            
            <div class="relative">
              <i class="fa-solid fa-magnifying-glass absolute left-3 top-1/2 -translate-y-1/2 text-ink-400"></i>
              <input id="global-search" class="field pl-10 w-64" placeholder="Search" />
            </div>
            <div class="w-10 h-10 rounded-full bg-white/10 grid place-items-center">
              <i class="fa-solid fa-user text-ink-300"></i>
              <span class="sr-only">Profile</span>
            </div>
          </div>
        </header>

        <!-- Route: Dashboard -->
        <section id="route-dashboard" class="space-y-6">
          <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4">
            <!-- KPI cards -->
            <div class="card metric p-5 animate-fade-up stat-card">
              <div class="flex items-center justify-between mb-2">
                <div class="text-ink-400 text-sm">Surveys</div>
                <i class="fa-solid fa-square-poll-vertical text-primary-400"></i>
              </div>
              <div class="kpi text-2xl font-semibold mt-1" id="kpi-surveys">--</div>
              <div class="flex items-center gap-2 mt-2 text-xs text-ink-400">
                <i class="fa-solid fa-arrow-up text-green-400"></i>
                <span>+12% from last week</span>
              </div>
            </div>
            
            <div class="card metric p-5 animate-fade-up stat-card" style="animation-delay:.05s">
              <div class="flex items-center justify-between mb-2">
                <div class="text-ink-400 text-sm">Responses</div>
                <i class="fa-solid fa-reply text-primary-400"></i>
              </div>
              <div class="kpi text-2xl font-semibold mt-1" id="kpi-responses">--</div>
              <div class="flex items-center gap-2 mt-2 text-xs text-ink-400">
                <i class="fa-solid fa-arrow-up text-green-400"></i>
                <span>+24% from last week</span>
              </div>
            </div>
            
            <div class="card metric p-5 animate-fade-up stat-card" style="animation-delay:.1s">
              <div class="flex items-center justify-between mb-2">
                <div class="text-ink-400 text-sm">Completion Rate</div>
                <i class="fa-solid fa-percent text-primary-400"></i>
              </div>
              <div class="kpi text-2xl font-semibold mt-1" id="kpi-completion">--</div>
              <div class="progress-bar mt-2">
                <div class="progress-fill" style="width: 0%" id="completion-progress"></div>
              </div>
            </div>
            
            <div class="card metric p-5 animate-fade-up stat-card" style="animation-delay:.15s">
              <div class="flex items-center justify-between mb-2">
                <div class="text-ink-400 text-sm">Active Now</div>
                <i class="fa-solid fa-users text-primary-400"></i>
              </div>
              <div class="kpi text-2xl font-semibold mt-1" id="kpi-active">--</div>
              <div class="flex items-center gap-2 mt-2 text-xs text-ink-400">
                <i class="fa-solid fa-clock text-amber-400"></i>
                <span>Real-time tracking</span>
              </div>
            </div>
          </div>

          <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
            <div class="card p-6 lg:col-span-2">
              <div class="flex items-center justify-between mb-4">
                <h2 class="font-semibold">Responses Over Time</h2>
                <div class="flex gap-2">
                  <button class="btn btn-ghost text-sm active" data-range="7d">7d</button>
                  <button class="btn btn-ghost text-sm" data-range="30d">30d</button>
                  <button class="btn btn-ghost text-sm" data-range="90d">90d</button>
                  <button class="btn btn-ghost text-sm" data-range="custom">
                    <i class="fa-solid fa-calendar-days"></i>
                  </button>
                </div>
              </div>
              <div class="relative h-72">
                <canvas id="chart-responses" aria-label="Responses chart"></canvas>
                <div id="empty-responses" class="empty absolute inset-0 rounded-xl grid place-items-center text-ink-400 text-sm">
                  <div class="text-center">
                    <i class="fa-solid fa-chart-line text-3xl mb-3 opacity-50"></i>
                    <p>No response data available</p>
                    <p class="text-xs mt-2">Create and share surveys to collect responses</p>
                  </div>
                </div>
              </div>
            </div>
            
            <div class="card p-6">
              <div class="flex items-center justify-between mb-4">
                <h2 class="font-semibold">Survey Status</h2>
                <button class="btn btn-ghost text-sm">
                  <i class="fa-solid fa-ellipsis"></i>
                </button>
              </div>
              <div class="relative h-72">
                <canvas id="chart-status" aria-label="Status chart"></canvas>
                <div id="empty-status" class="empty absolute inset-0 rounded-xl grid place-items-center text-ink-400 text-sm">
                  <div class="text-center">
                    <i class="fa-solid fa-chart-pie text-3xl mb-3 opacity-50"></i>
                    <p>No survey data available</p>
                    <p class="text-xs mt-2">Create surveys to see status distribution</p>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
            <div class="card p-6">
              <div class="flex items-center justify-between mb-3">
                <h2 class="font-semibold">Recent Activity</h2>
                <span class="badge" id="badge-activity">0 items</span>
              </div>
              <div id="activity" class="text-ink-400 text-sm">
                <div class="empty rounded-xl p-6 text-center">
                  <i class="fa-solid fa-bell text-3xl mb-3 opacity-50"></i>
                  <p>No activity yet</p>
                  <p class="text-xs mt-2">Your recent actions will appear here</p>
                </div>
              </div>
            </div>
            
            <div class="card p-6">
              <div class="flex items-center justify-between mb-3">
                <h2 class="font-semibold">Top Performing Surveys</h2>
                <span class="badge" id="badge-top-surveys">0 items</span>
              </div>
              <div id="top-surveys" class="text-ink-400 text-sm">
                <div class="empty rounded-xl p-6 text-center">
                  <i class="fa-solid fa-trophy text-3xl mb-3 opacity-50"></i>
                  <p>No survey data available</p>
                  <p class="text-xs mt-2">Create and share surveys to see performance metrics</p>
                </div>
              </div>
            </div>
          </div>
        </section>

        <!-- Route: Surveys -->
        <section id="route-surveys" class="hidden">
          <div class="flex items-center justify-between mb-6">
            <div>
              <h1 class="text-xl font-semibold">Surveys</h1>
              <p class="text-ink-400 text-sm">Create and manage your surveys</p>
            </div>
            <div class="flex items-center gap-3">
              <div class="relative">
                <i class="fa-solid fa-magnifying-glass absolute left-3 top-1/2 -translate-y-1/2 text-ink-400"></i>
                <input id="survey-search" class="field pl-10 w-64" placeholder="Search surveys..." />
              </div>
              <button id="btn-create" class="btn btn-primary"><i class="fa-solid fa-plus"></i> New Survey</button>
            </div>
          </div>
          
          <div class="filter-bar flex items-center gap-4 mb-6">
            <span class="text-sm text-ink-400">Filter by:</span>
            <div class="flex items-center gap-2 flex-wrap">
              <div class="filter-pill active" data-filter="all">All</div>
              <div class="filter-pill" data-filter="active">Active</div>
              <div class="filter-pill" data-filter="draft">Draft</div>
              <div class="filter-pill" data-filter="closed">Closed</div>
              <div class="filter-pill" data-filter="archived">Archived</div>
            </div>
          </div>
          
          <div id="surveys-list" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
            <!-- Survey cards will be dynamically added here -->
          </div>
          
          <div id="surveys-empty" class="empty rounded-xl p-6 text-ink-400 text-center">
            <i class="fa-solid fa-square-poll-vertical text-3xl mb-3 opacity-50"></i>
            <p>No surveys yet</p>
            <p class="text-sm mt-2">Get started by creating your first survey</p>
            <button class="btn btn-primary mt-4"><i class="fa-solid fa-plus"></i> Create Survey</button>
          </div>
        </section>

        <!-- Route: Share -->
        <section id="route-share" class="hidden">
          <div class="flex items-center justify-between mb-6">
            <div>
              <h1 class="text-xl font-semibold">Share Surveys</h1>
              <p class="text-ink-400 text-sm">Distribute your surveys with advanced sharing options</p>
            </div>
            <div class="flex items-center gap-3">
              <button class="btn btn-ghost"><i class="fa-solid fa-download"></i> Export</button>
              <button class="btn btn-primary" id="generate-share-link"><i class="fa-solid fa-link"></i> Generate Link</button>
            </div>
          </div>
          
          <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
            <div class="share-option card p-5" data-option="link">
              <div class="flex items-center gap-3 mb-3">
                <div class="w-10 h-10 rounded-lg bg-primary-500/20 grid place-items-center">
                  <i class="fa-solid fa-link text-primary-400"></i>
                </div>
                <h3 class="font-medium">Survey Links</h3>
              </div>
              <p class="text-sm text-ink-400 mb-4">Create and manage shareable links for your surveys with customizable access controls</p>
              <button class="btn btn-primary w-full">Manage Links</button>
            </div>
            
            <div class="share-option card p-5" data-option="audience">
              <div class="flex items-center gap-3 mb-3">
                <div class="w-10 h-10 rounded-lg bg-primary-500/20 grid place-items-center">
                  <i class="fa-solid fa-user-group text-primary-400"></i>
                </div>
                <h3 class="font-medium">Audience Groups</h3>
              </div>
              <p class="text-sm text-ink-400 mb-4">Share with specific audience segments and manage distribution lists</p>
              <button class="btn btn-primary w-full">Create Group</button>
            </div>
            
            <div class="share-option card p-5" data-option="embed">
              <div class="flex items-center gap-3 mb-3">
                <div class="w-10 h-10 rounded-lg bg-primary-500/20 grid place-items-center">
                  <i class="fa-solid fa-code text-primary-400"></i>
                </div>
                <h3 class="font-medium">Embed on Website</h3>
              </div>
              <p class="text-sm text-ink-400 mb-4">Embed surveys directly on your website with customizable styling options</p>
              <button class="btn btn-primary w-full">Get Embed Code</button>
            </div>
            
            <div class="share-option card p-5" data-option="email">
              <div class="flex items-center gap-3 mb-3">
                <div class="w-10 h-10 rounded-lg bg-primary-500/20 grid place-items-center">
                  <i class="fa-solid fa-envelope text-primary-400"></i>
                </div>
                <h3 class="font-medium">Email Campaign</h3>
              </div>
              <p class="text-sm text-ink-400 mb-4">Send surveys via email with tracking and reminder capabilities</p>
              <button class="btn btn-primary w-full">Create Campaign</button>
            </div>
          </div>
          
          <div class="card p-6 mb-6">
            <h3 class="font-medium mb-4 flex items-center gap-2">
              <i class="fa-solid fa-shield-halved text-security-400"></i>
              Government Security Options
            </h3>
            
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
              <div class="security-level">
                <div class="security-icon">
                  <i class="fa-solid fa-lock text-security-400"></i>
                </div>
                <div>
                  <h4 class="font-medium">End-to-End Encryption</h4>
                  <p class="text-sm text-ink-400">Military-grade encryption for all data in transit and at rest</p>
                </div>
              </div>
              
              <div class="security-level">
                <div class="security-icon">
                  <i class="fa-solid fa-user-shield text-security-400"></i>
                </div>
                <div>
                  <h4 class="font-medium">Access Controls</h4>
                  <p class="text-sm text-ink-400">Role-based access control with multi-factor authentication</p>
                </div>
              </div>
              
              <div class="security-level">
                <div class="security-icon">
                  <i class="fa-solid fa-file-shield text-security-400"></i>
                </div>
                <div>
                  <h4 class="font-medium">Data Sovereignty</h4>
                  <p class="text-sm text-ink-400">Choose specific geographic regions for data storage</p>
                </div>
              </div>
              
              <div class="security-level">
                <div class="security-icon">
                  <i class="fa-solid fa-clock-rotate-left text-security-400"></i>
                </div>
                <div>
                  <h4 class="font-medium">Audit Logging</h4>
                  <p class="text-sm text-ink-400">Comprehensive audit trails for all system activities</p>
                </div>
              </div>
            </div>
            
            <div class="mt-6 pt-6 border-t border-white/10">
              <button class="btn btn-security w-full" id="enable-government-security">
                <i class="fa-solid fa-shield-halved"></i> Enable Government Security Mode
              </button>
            </div>
          </div>
          
          <h3 class="font-medium mb-3">Recently Shared</h3>
          <div class="empty rounded-xl p-6 text-ink-400 text-center">
            <i class="fa-solid fa-share-nodes text-3xl mb-3 opacity-50"></i>
            <p>No shared surveys yet</p>
            <p class="text-sm mt-2">Share a survey to see it listed here</p>
          </div>
        </section>

        <!-- Route: Drag & Drop Builder -->
        <section id="route-builder" class="hidden">
          <div class="card p-6">
            <div class="builder-toolbar">
              <div>
                <h2 class="builder-title">Survey Builder</h2>
                <p class="text-ink-400 text-sm">Drag and drop components to create your survey</p>
              </div>
              <div class="builder-actions">
                <button class="btn btn-ghost" id="preview-survey"><i class="fa-solid fa-eye"></i> Preview</button>
                <button class="btn btn-primary" id="save-survey"><i class="fa-solid fa-floppy-disk"></i> Save</button>
              </div>
            </div>
            
            <div class="builder-container">
              <!-- Components Panel -->
              <div class="components-panel">
                <div class="component-search">
                  <i class="fa-solid fa-magnifying-glass"></i>
                  <input type="text" class="field" placeholder="Search components..." id="component-search">
                </div>
                
                <div class="component-category">
                  <div class="component-category-title">Basic Questions</div>
                  
                  <div class="component-item" draggable="true" data-type="text">
                    <i class="fa-solid fa-grip-lines text-ink-400"></i>
                    <i class="fa-solid fa-font text-primary-400"></i>
                    <span>Text Question</span>
                  </div>
                  
                  <div class="component-item" draggable="true" data-type="multiple">
                    <i class="fa-solid fa-grip-lines text-ink-400"></i>
                    <i class="fa-solid fa-list-ol text-primary-400"></i>
                    <span>Multiple Choice</span>
                  </div>
                  
                  <div class="component-item" draggable="true" data-type="checkbox">
                    <i class="fa-solid fa-grip-lines text-ink-400"></i>
                    <i class="fa-solid fa-square-check text-primary-400"></i>
                    <span>Checkboxes</span>
                  </div>
                  
                  <div class="component-item" draggable="true" data-type="dropdown">
                    <i class="fa-solid fa-grip-lines text-ink-400"></i>
                    <i class="fa-solid fa-caret-down text-primary-400"></i>
                    <span>Dropdown</span>
                  </div>
                </div>
                
                <div class="component-category">
                  <div class="component-category-title">Advanced Questions</div>
                  
                  <div class="component-item" draggable="true" data-type="rating">
                    <i class="fa-solid fa-grip-lines text-ink-400"></i>
                    <i class="fa-solid fa-star text-primary-400"></i>
                    <span>Rating</span>
                  </div>
                  
                  <div class="component-item" draggable="true" data-type="date">
                    <i class="fa-solid fa-grip-lines text-ink-400"></i>
                    <i class="fa-solid fa-calendar-days text-primary-400"></i>
                    <span>Date Picker</span>
                  </div>
                  
                  <div class="component-item" draggable="true" data-type="scale">
                    <i class="fa-solid fa-grip-lines text-ink-400"></i>
                    <i class="fa-solid fa-sliders text-primary-400"></i>
                    <span>Linear Scale</span>
                  </div>
                  
                  <div class="component-item" draggable="true" data-type="file">
                    <i class="fa-solid fa-grip-lines text-ink-400"></i>
                    <i class="fa-solid fa-file-arrow-up text-primary-400"></i>
                    <span>File Upload</span>
                  </div>
                </div>
                
                <div class="component-category">
                  <div class="component-category-title">Layout</div>
                  
                  <div class="component-item" draggable="true" data-type="section">
                    <i class="fa-solid fa-grip-lines text-ink-400"></i>
                    <i class="fa-solid fa-bars text-primary-400"></i>
                    <span>Section Header</span>
                  </div>
                  
                  <div class="component-item" draggable="true" data-type="matrix">
                    <i class="fa-solid fa-grip-lines text-ink-400"></i>
                    <i class="fa-solid fa-table-cells text-primary-400"></i>
                    <span>Matrix Table</span>
                  </div>
                </div>
                
                <div class="component-category">
                  <div class="component-category-title">Specialized</div>
                  
                  <div class="component-item" draggable="true" data-type="ranking">
                    <i class="fa-solid fa-grip-lines text-ink-400"></i>
                    <i class="fa-solid fa-arrow-up-short-wide text-primary-400"></i>
                    <span>Ranking</span>
                  </div>
                  
                  <div class="component-item" draggable="true" data-type="nps">
                    <i class="fa-solid fa-grip-lines text-ink-400"></i>
                    <i class="fa-solid fa-thumbs-up text-primary-400"></i>
                    <span>NPS Score</span>
                  </div>
                </div>
              </div>
              
              <!-- Canvas Panel -->
              <div class="canvas-panel">
                <div class="canvas-area" id="survey-canvas">
                  <div class="drop-zone" id="canvas-drop-zone">
                    <i class="fa-solid fa-arrow-down text-2xl mb-2 text-primary-400"></i>
                    <p class="text-sm">Drag components here to build your survey</p>
                  </div>
                  
                  <!-- Example questions (would be dynamically generated) -->
                  <div class="canvas-item" data-type="text" data-id="sample1">
                    <div class="item-controls">
                      <div class="control-btn" onclick="editQuestion('sample1')"><i class="fa-solid fa-pen fa-xs"></i></div>
                      <div class="control-btn" onclick="deleteQuestion('sample1')"><i class="fa-solid fa-trash fa-xs"></i></div>
                    </div>
                    <div class="question-preview">
                      <div class="question-text">What is your name?</div>
                      <div class="question-type">Text Question</div>
                      <input type="text" class="field w-full mt-2" placeholder="Type your answer here" disabled>
                    </div>
                  </div>
                  
                  <div class="canvas-item" data-type="multiple" data-id="sample2">
                    <div class="item-controls">
                      <div class="control-btn" onclick="editQuestion('sample2')"><i class="fa-solid fa-pen fa-xs"></i></div>
                      <div class="control-btn" onclick="deleteQuestion('sample2')"><i class="fa-solid fa-trash fa-xs"></i></div>
                    </div>
                    <div class="question-preview">
                      <div class="question-text">Which option do you prefer?</div>
                      <div class="question-type">Multiple Choice</div>
                      <div class="space-y-2 mt-2">
                        <div class="flex items-center gap-2">
                          <input type="radio" disabled class="rounded-full">
                          <label class="text-sm">Option 1</label>
                        </div>
                        <div class="flex items-center gap-2">
                          <input type="radio" disabled class="rounded-full">
                          <label class="text-sm">Option 2</label>
                        </div>
                        <div class="flex items-center gap-2">
                          <input type="radio" disabled class="rounded-full">
                          <label class="text-sm">Option 3</label>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </section>

        <!-- Route: Analytics -->
        <section id="route-analytics" class="hidden">
          <div class="flex items-center justify-between mb-6">
            <div>
              <h1 class="text-xl font-semibold">Analytics</h1>
              <p class="text-ink-400 text-sm">Gain insights from your survey data</p>
            </div>
            <div class="flex items-center gap-3">
              <div class="relative">
                <i class="fa-solid fa-magnifying-glass absolute left-3 top-1/2 -translate-y-1/2 text-ink-400"></i>
                <input class="field pl-10 w-64" placeholder="Search analytics..." />
              </div>
              <button class="btn btn-primary"><i class="fa-solid fa-download"></i> Export Report</button>
            </div>
          </div>
          
          <div class="filter-bar flex items-center gap-4 mb-6">
            <span class="text-sm text-ink-400">Time range:</span>
            <div class="flex items-center gap-2 flex-wrap">
              <div class="filter-pill active">Last 7 days</div>
              <div class="filter-pill">Last 30 days</div>
              <div class="filter-pill">Last 90 days</div>
              <div class="filter-pill">Custom range</div>
            </div>
          </div>
          
          <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6">
            <div class="card p-6">
              <h3 class="font-medium mb-4">Response Rate</h3>
              <div class="relative h-72">
                <canvas id="chart-response-rate" aria-label="Response rate chart"></canvas>
                <div class="empty absolute inset-0 rounded-xl grid place-items-center text-ink-400 text-sm">
                  <div class="text-center">
                    <i class="fa-solid fa-chart-line text-3xl mb-3 opacity-50"></i>
                    <p>No response data available</p>
                  </div>
                </div>
              </div>
            </div>
            
            <div class="card p-6">
              <h3 class="font-medium mb-4">Completion by Device</h3>
              <div class="relative h-72">
                <canvas id="chart-device-breakdown" aria-label="Device breakdown chart"></canvas>
                <div class="empty absolute inset-0 rounded-xl grid place-items-center text-ink-400 text-sm">
                  <div class="text-center">
                    <i class="fa-solid fa-mobile-screen text-3xl mb-3 opacity-50"></i>
                    <p>No device data available</p>
                  </div>
                </div>
              </div>
            </div>
          </div>
          
          <div class="card p-6">
            <h3 class="font-medium mb-4">Detailed Responses</h3>
            <div class="overflow-x-auto">
              <table class="data-table">
                <thead>
                  <tr>
                    <th>Survey</th>
                    <th>Responses</th>
                    <th>Completion Rate</th>
                    <th>Avg. Time</th>
                    <th>Status</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td colspan="5" class="text-center py-8 text-ink-400">
                      <i class="fa-solid fa-table text-3xl mb-3 opacity-50"></i>
                      <p>No response data available</p>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </section>

        <!-- Route: Audience -->
        <section id="route-audience" class="hidden">
          <div class="flex items-center justify-between mb-6">
            <div>
              <h1 class="text-xl font-semibold">Audience</h1>
              <p class="text-ink-400 text-sm">Manage your survey participants</p>
            </div>
            <div class="flex items-center gap-3">
              <div class="relative">
                <i class="fa-solid fa-magnifying-glass absolute left-3 top-1/2 -translate-y-1/2 text-ink-400"></i>
                <input class="field pl-10 w-64" placeholder="Search audience..." />
              </div>
              <button class="btn btn-primary"><i class="fa-solid fa-plus"></i> Add Contact</button>
            </div>
          </div>
          
          <div class="filter-bar flex items-center gap-4 mb-6">
            <span class="text-sm text-ink-400">Filter by:</span>
            <div class="flex items-center gap-2 flex-wrap">
              <div class="filter-pill active">All Contacts</div>
              <div class="filter-pill">Recent</div>
              <div class="filter-pill">By Group</div>
              <div class="filter-pill">Unsubscribed</div>
            </div>
          </div>
          
          <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 mb-6">
            <div class="card p-6">
              <h3 class="font-medium mb-4">Audience Overview</h3>
              <div class="space-y-4">
                <div class="flex items-center justify-between">
                  <span class="text-ink-400">Total Contacts</span>
                  <span class="font-semibold">0</span>
                </div>
                <div class="flex items-center justify-between">
                  <span class="text-ink-400">Active</span>
                  <span class="font-semibold">0</span>
                </div>
                <div class="flex items-center justify-between">
                  <span class="text-ink-400">Unsubscribed</span>
                  <span class="font-semibold">0</span>
                </div>
                <div class="flex items-center justify-between">
                  <span class="text-ink-400">Groups</span>
                  <span class="font-semibold">0</span>
                </div>
              </div>
            </div>
            
            <div class="card p-6 lg:col-span-2">
              <h3 class="font-medium mb-4">Contact Growth</h3>
              <div class="relative h-64">
                <canvas id="chart-audience-growth" aria-label="Audience growth chart"></canvas>
                <div class="empty absolute inset-0 rounded-xl grid place-items-center text-ink-400 text-sm">
                  <div class="text-center">
                    <i class="fa-solid fa-user-group text-3xl mb-3 opacity-50"></i>
                    <p>No audience data available</p>
                  </div>
                </div>
              </div>
            </div>
          </div>
          
          <div class="card p-6">
            <h3 class="font-medium mb-4">Contact List</h3>
            <div class="overflow-x-auto">
              <table class="data-table">
                <thead>
                  <tr>
                    <th>Name</th>
                    <th>Email</th>
                    <th>Group</th>
                    <th>Status</th>
                    <th>Last Activity</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td colspan="5" class="text-center py-8 text-ink-400">
                      <i class="fa-solid fa-address-book text-3xl mb-3 opacity-50"></i>
                      <p>No contacts yet</p>
                      <p class="text-sm mt-2">Add contacts to build your audience</p>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </section>

        <!-- Route: Settings -->
        <section id="route-settings" class="hidden">
          <div class="flex items-center justify-between mb-6">
            <div>
              <h1 class="text-xl font-semibold">Settings</h1>
              <p class="text-ink-400 text-sm">Configure your account and preferences</p>
            </div>
          </div>
          
          <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
            <div class="card p-6">
              <h3 class="font-medium mb-4">Account Settings</h3>
              <div class="space-y-4">
                <label class="block">
                  <span class="block text-sm mb-1">Full Name</span>
                  <input type="text" class="field w-full" value="Your Name" />
                </label>
                <label class="block">
                  <span class="block text-sm mb-1">Email Address</span>
                  <input type="email" class="field w-full" value="you@company.com" />
                </label>
                <label class="block">
                  <span class="block text-sm mb-1">Time Zone</span>
                  <select class="field w-full">
                    <option>(UTC-08:00) Pacific Time</option>
                    <option>(UTC-07:00) Mountain Time</option>
                    <option>(UTC-06:00) Central Time</option>
                    <option>(UTC-05:00) Eastern Time</option>
                  </select>
                </label>
                <button class="btn btn-primary w-full">Save Changes</button>
              </div>
            </div>
            
            <div class="card p-6">
              <h3 class="font-medium mb-4">Interface Preferences</h3>
              <div class="space-y-4">
                <label class="block">
                  <span class="block text-sm mb-1">Interface Language</span>
                  <select id="setting-lang" class="field w-full">
                    <option value="en" selected>English</option>
                    <option value="es">Español</option>
                    <option value="fr">Français</option>
                    <option value="de">Deutsch</option>
                    <option value="zh">中文</option>
                  </select>
                </label>
                <label class="inline-flex items-center gap-2 justify-between w-full">
                  <span class="text-sm">Compact Mode</span>
                  <input id="setting-compact" type="checkbox" class="toggle-switch" />
                </label>
                <label class="inline-flex items-center gap-2 justify-between w-full">
                  <span class="text-sm">Dark Mode</span>
                  <input type="checkbox" class="toggle-switch" checked />
                </label>
                <label class="inline-flex items-center gap-2 justify-between w-full">
                  <span class="text-sm">Email Notifications</span>
                  <input type="checkbox" class="toggle-switch" checked />
                </label>
              </div>
            </div>
            
            <div class="card p-6">
              <h3 class="font-medium mb-4 flex items-center gap-2">
                <i class="fa-solid fa-shield-halved text-security-400"></i>
                Security Settings
              </h3>
              <div class="space-y-4">
                <div class="security-badge">
                  <i class="fa-solid fa-lock"></i>
                  <span>Standard Security</span>
                </div>
                
                <div class="space-y-3">
                  <h4 class="font-medium text-sm">Two-Factor Authentication</h4>
                  <div class="flex items-center justify-between">
                    <span class="text-ink-400 text-sm">2FA Status</span>
                    <span class="badge">Disabled</span>
                  </div>
                  <button class="btn btn-security w-full" id="enable-2fa">
                    <i class="fa-solid fa-shield-halved"></i> Enable 2FA
                  </button>
                </div>
                
                <div class="space-y-3 pt-4 border-t border-white/10">
                  <h4 class="font-medium text-sm">Government Security Mode</h4>
                  <p class="text-ink-400 text-xs">Enable for enhanced security compliance with government standards</p>
                  <button class="btn btn-security w-full" id="enable-gov-security">
                    <i class="fa-solid fa-building-shield"></i> Enable Government Mode
                  </button>
                </div>
              </div>
            </div>
          </div>
          
          <div class="card p-6 mt-6">
            <h3 class="font-medium mb-4">Audit Log</h3>
            <div class="space-y-3">
              <div class="audit-log-item success">
                <div class="flex items-center justify-between">
                  <div>
                    <div class="font-medium">User login</div>
                    <div class="text-ink-400 text-sm">Successful login from Chrome on Windows</div>
                  </div>
                  <div class="text-ink-400 text-sm">2 minutes ago</div>
                </div>
              </div>
              
              <div class="audit-log-item">
                <div class="flex items-center justify-between">
                  <div>
                    <div class="font-medium">Settings updated</div>
                    <div class="text-ink-400 text-sm">Interface preferences modified</div>
                  </div>
                  <div class="text-ink-400 text-sm">15 minutes ago</div>
                </div>
              </div>
              
              <div class="audit-log-item warning">
                <div class="flex items-center justify-between">
                  <div>
                    <div class="font-medium">Failed login attempt</div>
                    <div class="text-ink-400 text-sm">Invalid credentials from Firefox on MacOS</div>
                  </div>
                  <div class="text-ink-400 text-sm">1 hour ago</div>
                </div>
              </div>
            </div>
            
            <button class="btn btn-ghost w-full mt-4">View Full Audit Log</button>
          </div>
        </section>
      </main>
    </div>
  </section>

  <!-- Question Settings Panel -->
  <div class="question-settings" id="question-settings">
    <div class="settings-header">
      <h3 class="settings-title">Question Settings</h3>
      <div class="settings-close" onclick="closeQuestionSettings()">
        <i class="fa-solid fa-xmark"></i>
      </div>
    </div>
    
    <div class="settings-section">
      <h4 class="settings-section-title">General</h4>
      <div class="settings-option">
        <span class="settings-option-label">Required</span>
        <input type="checkbox" class="toggle-switch" id="settings-required">
      </div>
      <div class="settings-option">
        <span class="settings-option-label">Shuffle Options</span>
        <input type="checkbox" class="toggle-switch" id="settings-shuffle">
      </div>
    </div>
    
    <div class="settings-section">
      <h4 class="settings-section-title">Validation</h4>
      <div class="settings-option">
        <span class="settings-option-label">Min Characters</span>
        <input type="number" class="field w-20" id="settings-min-chars" min="0">
      </div>
      <div class="settings-option">
        <span class="settings-option-label">Max Characters</span>
        <input type="number" class="field w-20" id="settings-max-chars" min="0">
      </div>
    </div>
    
    <div class="settings-section">
      <h4 class="settings-section-title">Appearance</h4>
      <div class="settings-option">
        <span class="settings-option-label">Question Layout</span>
        <select class="field" id="settings-layout">
          <option>Standard</option>
          <option>Compact</option>
          <option>Side-by-side</option>
        </select>
      </div>
      <div class="settings-option">
        <span class="settings-option-label">Image</span>
        <button class="btn btn-ghost w-full">Upload Image</button>
      </div>
    </div>
    
    <div class="settings-section">
      <h4 class="settings-section-title">Logic</h4>
      <div class="settings-option">
        <span class="settings-option-label">Show if</span>
        <select class="field" id="settings-logic">
          <option>Always show</option>
          <option>Based on previous answer</option>
          <option>Based on custom logic</option>
        </select>
      </div>
    </div>
    
    <div class="settings-section">
      <button class="btn btn-primary w-full" onclick="applyQuestionSettings()">Apply Settings</button>
    </div>
  </div>

  <!-- Create Survey Modal -->
  <div id="create-survey-modal" class="modal hidden">
    <div class="modal-content card p-6">
      <div class="flex items-center justify-between mb-4">
        <h2 class="text-xl font-semibold">Create New Survey</h2>
        <button class="btn btn-ghost p-2" id="close-create-modal">
          <i class="fa-solid fa-xmark"></i>
        </button>
      </div>
      
      <div class="mb-4">
        <label class="block mb-2">
          <span class="block text-sm mb-1">Survey Title</span>
          <input type="text" id="survey-title" class="field w-full" placeholder="Enter survey title" />
        </label>
      </div>
      
      <h3 class="font-medium mb-3">Choose Creation Method</h3>
      
      <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
        <div class="survey-option card p-5 cursor-pointer text-center" data-method="blank">
          <div class="w-12 h-12 rounded-full bg-primary-500/20 grid place-items-center mx-auto mb-3">
            <i class="fa-solid fa-file text-primary-400"></i>
          </div>
          <h4 class="font-medium mb-1">Start from Scratch</h4>
          <p class="text-xs text-ink-400">Create a custom survey with your own questions</p>
        </div>
        
        <div class="survey-option card p-5 cursor-pointer text-center" data-method="template">
          <div class="w-12 h-12 rounded-full bg-primary-500/20 grid place-items-center mx-auto mb-3">
            <i class="fa-solid fa-grid-2 text-primary-400"></i>
          </div>
          <h4 class="font-medium mb-1">Use a Template</h4>
          <p class="text-xs text-ink-400">Choose from professionally designed templates</p>
        </div>
        
        <div class="survey-option card p-5 cursor-pointer text-center" data-method="ai">
          <div class="w-12 h-12 rounded-full bg-primary-500/20 grid place-items-center mx-auto mb-3">
            <i class="fa-solid fa-wand-magic-sparkles text-primary-400"></i>
          </div>
          <h4 class="font-medium mb-1">AI Assistant</h4>
          <p class="text-xs text-ink-400">Let AI generate a survey based on your topic</p>
        </div>
        
        <div class="survey-option card p-5 cursor-pointer text-center" data-method="import">
          <div class="w-12 h-12 rounded-full bg-primary-500/20 grid place-items-center mx-auto mb-3">
            <i class="fa-solid fa-file-import text-primary-400"></i>
          </div>
          <h4 class="font-medium mb-1">Import Questions</h4>
          <p class="text-xs text-ink-400">Import from CSV, Word, or other formats</p>
        </div>
      </div>
      
      <div class="flex justify-end gap-3">
        <button class="btn btn-ghost" id="cancel-create">Cancel</button>
        <button class="btn btn-primary" id="confirm-create" disabled>Create Survey</button>
      </div>
    </div>
  </div>

  <!-- Share Survey Modal -->
  <div id="share-survey-modal" class="modal hidden">
    <div class="modal-content card p-6 max-w-md">
      <div class="flex items-center justify-between mb-4">
        <h2 class="text-xl font-semibold">Share Survey</h2>
        <button class="btn btn-ghost p-2" id="close-share-modal">
          <i class="fa-solid fa-xmark"></i>
        </button>
      </div>
      
      <div class="mb-4">
        <label class="block mb-2">
          <span class="block text-sm mb-1">Survey Link</span>
          <div class="flex gap-2">
            <input type="text" id="survey-link" class="field w-full" readonly value="https://surveycraft.pro/s/abc123" />
            <button class="btn btn-ghost flex-shrink-0" id="copy-link">
              <i class="fa-regular fa-copy"></i>
            </button>
          </div>
        </label>
      </div>
      
      <div class="mb-4">
        <label class="block mb-2">
          <span class="block text-sm mb-1">Link Expiration</span>
          <select class="field w-full">
            <option>No expiration</option>
            <option>1 day</option>
            <option>7 days</option>
            <option>30 days</option>
            <option>Custom date</option>
          </select>
        </label>
      </div>
      
      <div class="mb-4">
        <label class="block mb-2">
          <span class="block text-sm mb-1">Response Limit</span>
          <input type="number" class="field w-full" placeholder="No limit" />
        </label>
      </div>
      
      <h3 class="font-medium mb-3">Share via</h3>
      
      <div class="grid grid-cols-4 gap-3 mb-6">
        <button class="btn btn-ghost flex flex-col items-center py-3">
          <i class="fa-brands fa-whatsapp text-green-400 text-xl mb-1"></i>
          <span class="text-xs">WhatsApp</span>
        </button>
        
        <button class="btn btn-ghost flex flex-col items-center py-3">
          <i class="fa-solid fa-envelope text-ink-300 text-xl mb-1"></i>
          <span class="text-xs">Email</span>
        </button>
        
        <button class="btn btn-ghost flex flex-col items-center py-3">
          <i class="fa-brands fa-facebook-messenger text-blue-400 text-xl mb-1"></i>
          <span class="text-xs">Messenger</span>
        </button>
        
        <button class="btn btn-ghost flex flex-col items-center py-3">
          <i class="fa-brands fa-slack text-orange-400 text-xl mb-1"></i>
          <span class="text-xs">Slack</span>
        </button>
        
        <button class="btn btn-ghost flex flex-col items-center py-3">
          <i class="fa-brands fa-linkedin text-blue-500 text-xl mb-1"></i>
          <span class="text-xs">LinkedIn</span>
        </button>
        
        <button class="btn btn-ghost flex flex-col items-center py-3">
          <i class="fa-brands fa-telegram text-blue-300 text-xl mb-1"></i>
          <span class="text-xs">Telegram</span>
        </button>
        
        <button class="btn btn-ghost flex flex-col items-center py-3">
          <i class="fa-brands fa-discord text-indigo-400 text-xl mb-1"></i>
          <span class="text-xs">Discord</span>
        </button>
        
        <button class="btn btn-ghost flex flex-col items-center py-3">
          <i class="fa-solid fa-qrcode text-ink-300 text-xl mb-1"></i>
          <span class="text-xs">QR Code</span>
        </button>
      </div>
      
      <h3 class="font-medium mb-3">Embed on Website</h3>
      
      <div class="mb-4">
        <div class="flex gap-2">
          <input type="text" id="embed-code" class="field w-full" readonly value='<iframe src="https://surveycraft.pro/embed/abc123" width="100%" height="500"></iframe>' />
          <button class="btn btn-ghost flex-shrink-0" id="copy-embed">
            <i class="fa-regular fa-copy"></i>
          </button>
        </div>
      </div>
      
      <div class="flex justify-end">
        <button class="btn btn-primary" id="done-share">Done</button>
      </div>
    </div>
  </div>

  <!-- Government Security Modal -->
  <div id="government-security-modal" class="modal hidden">
    <div class="modal-content card p-6 max-w-2xl">
      <div class="flex items-center justify-between mb-4">
        <h2 class="text-xl font-semibold flex items-center gap-2">
          <i class="fa-solid fa-building-shield text-security-400"></i>
          Government Security Settings
        </h2>
        <button class="btn btn-ghost p-2" id="close-security-modal">
          <i class="fa-solid fa-xmark"></i>
        </button>
      </div>
      
      <div class="space-y-6">
        <div class="security-level">
          <div class="security-icon">
            <i class="fa-solid fa-database text-security-400"></i>
          </div>
          <div class="flex-1">
            <h3 class="font-medium">Data Sovereignty</h3>
            <p class="text-sm text-ink-400 mb-3">Choose where your data is stored to comply with regional regulations</p>
            <select class="field w-full">
              <option>Global (Automatic)</option>
              <option>United States</option>
              <option>European Union</option>
              <option>United Kingdom</option>
              <option>Canada</option>
              <option>Australia</option>
              <option>Custom region</option>
            </select>
          </div>
        </div>
        
        <div class="security-level">
          <div class="security-icon">
            <i class="fa-solid fa-lock text-security-400"></i>
          </div>
          <div class="flex-1">
            <h3 class="font-medium">Encryption Level</h3>
            <p class="text-sm text-ink-400 mb-3">Select the encryption standard for your data</p>
            <select class="field w-full">
              <option>Standard (AES-256)</option>
              <option>Enhanced (FIPS 140-2 Compliant)</option>
              <option>Government (FIPS 140-3 Compliant)</option>
            </select>
          </div>
        </div>
        
        <div class="security-level">
          <div class="security-icon">
            <i class="fa-solid fa-user-shield text-security-400"></i>
          </div>
          <div class="flex-1">
            <h3 class="font-medium">Access Controls</h3>
            <p class="text-sm text-ink-400 mb-3">Configure who can access your survey data</p>
            <div class="space-y-3">
              <label class="inline-flex items-center gap-2 justify-between w-full">
                <span class="text-sm">Multi-factor Authentication Required</span>
                <input type="checkbox" class="toggle-switch" />
              </label>
              <label class="inline-flex items-center gap-2 justify-between w-full">
                <span class="text-sm">IP Address Restrictions</span>
                <input type="checkbox" class="toggle-switch" />
              </label>
              <label class="inline-flex items-center gap-2 justify-between w-full">
                <span class="text-sm">Time-based Access Controls</span>
                <input type="checkbox" class="toggle-switch" />
              </label>
            </div>
          </div>
        </div>
        
        <div class="security-level">
          <div class="security-icon">
            <i class="fa-solid fa-file-shield text-security-400"></i>
          </div>
          <div class="flex-1">
            <h3 class="font-medium">Data Retention</h3>
            <p class="text-sm text-ink-400 mb-3">Set policies for automatic data deletion</p>
            <select class="field w-full">
              <option>No automatic deletion</option>
              <option>30 days after survey completion</option>
              <option>6 months after survey completion</option>
              <option>1 year after survey completion</option>
              <option>Custom period</option>
            </select>
          </div>
        </div>
        
        <div class="security-level">
          <div class="security-icon">
            <i class="fa-solid fa-clock-rotate-left text-security-400"></i>
          </div>
          <div class="flex-1">
            <h3 class="font-medium">Audit Logging</h3>
            <p class="text-sm text-ink-400 mb-3">Configure comprehensive audit trails</p>
            <div class="space-y-3">
              <label class="inline-flex items-center gap-2 justify-between w-full">
                <span class="text-sm">Enable Detailed Audit Logs</span>
                <input type="checkbox" class="toggle-switch" checked />
              </label>
              <label class="inline-flex items-center gap-2 justify-between w-full">
                <span class="text-sm">Log Data Access Events</span>
                <input type="checkbox" class="toggle-switch" checked />
              </label>
              <label class="inline-flex items-center gap-2 justify-between w-full">
                <span class="text-sm">Log Configuration Changes</span>
                <input type="checkbox" class="toggle-switch" checked />
              </label>
            </div>
          </div>
        </div>
      </div>
      
      <div class="flex justify-end gap-3 mt-6">
        <button class="btn btn-ghost" id="cancel-security">Cancel</button>
        <button class="btn btn-security" id="save-security">
          <i class="fa-solid fa-shield-halved"></i> Apply Security Settings
        </button>
      </div>
    </div>
  </div>

  <!-- Preview Survey Modal -->
  <div id="preview-survey-modal" class="modal hidden">
    <div class="modal-content card p-6 max-w-2xl">
      <div class="flex items-center justify-between mb-4">
        <h2 class="text-xl font-semibold">Survey Preview</h2>
        <button class="btn btn-ghost p-2" id="close-preview-modal">
          <i class="fa-solid fa-xmark"></i>
        </button>
      </div>
      
      <div class="survey-preview">
        <div class="survey-preview-header">
          <h1 class="survey-preview-title" id="preview-title">Survey Title</h1>
          <p class="survey-preview-description" id="preview-description">Survey description goes here</p>
        </div>
        
        <div id="preview-content">
          <!-- Preview content will be generated here -->
        </div>
        
        <div class="survey-preview-submit">
          <button class="btn btn-primary" id="submit-preview">Submit Preview</button>
        </div>
      </div>
      
      <div class="flex justify-end gap-3 mt-6">
        <button class="btn btn-ghost" id="cancel-preview">Close</button>
      </div>
    </div>
  </div>

  <!-- Edit Question Modal -->
  <div id="edit-question-modal" class="modal hidden">
    <div class="modal-content card p-6 edit-question-modal">
      <div class="flex items-center justify-between mb-4">
        <h2 class="text-xl font-semibold">Edit Question</h2>
        <button class="btn btn-ghost p-2" id="close-edit-modal">
          <i class="fa-solid fa-xmark"></i>
        </button>
      </div>
      
      <form id="edit-question-form" class="edit-question-form">
        <div class="form-group">
          <label for="edit-question-text">Question Text</label>
          <input type="text" id="edit-question-text" class="field" placeholder="Enter your question" required />
        </div>
        
        <div class="form-group">
          <label for="edit-question-description">Description (Optional)</label>
          <textarea id="edit-question-description" class="field" rows="2" placeholder="Add more context to your question"></textarea>
        </div>
        
        <div class="form-group">
          <label for="edit-question-type">Question Type</label>
          <select id="edit-question-type" class="field" disabled>
            <option value="text">Text</option>
            <option value="multiple">Multiple Choice</option>
            <option value="checkbox">Checkboxes</option>
            <option value="dropdown">Dropdown</option>
            <option value="rating">Rating</option>
            <option value="date">Date</option>
            <option value="scale">Linear Scale</option>
            <option value="file">File Upload</option>
            <option value="section">Section Header</option>
            <option value="matrix">Matrix Table</option>
            <option value="ranking">Ranking</option>
            <option value="nps">NPS Score</option>
          </select>
        </div>
        
        <div class="form-group">
          <label class="inline-flex items-center gap-2">
            <input type="checkbox" id="edit-question-required" />
            <span for="edit-question-required">Required question</span>
          </label>
        </div>
        
        <div id="edit-options-container" class="form-group" style="display: none;">
          <label>Options</label>
          <div class="options-list" id="edit-options-list">
            <!-- Options will be dynamically added here -->
          </div>
          <div class="add-option-btn" id="add-option-btn">
            <i class="fa-solid fa-plus"></i> Add Option
          </div>
        </div>
        
        <div class="form-actions">
          <button type="button" class="btn btn-ghost" id="cancel-edit">Cancel</button>
          <button type="submit" class="btn btn-primary">Save Changes</button>
        </div>
      </form>
    </div>
  </div>

  <footer class="text-center text-xs text-ink-500 py-6">© <span id="year"></span> Rexus Group 2025. All rights reserved.</footer>

  <script>
    // --- Enhanced app state & functionality ---
    const $ = (sel, ctx=document) => ctx.querySelector(sel);
    const $$ = (sel, ctx=document) => Array.from(ctx.querySelectorAll(sel));

    const state = {
      authed: false,
      metrics: { surveys: null, responses: null, completion: null, active: null },
      activity: [],
      charts: { responses: null, status: null },
      language: 'en',
      currentEditingQuestion: null,
      currentSurveyId: null,
      currentQuestionId: null,
      surveyData: {
        title: '',
        description: '',
        questions: []
      },
      settings: {
        compactMode: false,
        darkMode: true,
        emailNotifications: true,
        governmentSecurity: false,
        twoFactorAuth: false
      },
      surveys: [
        {
          id: 1,
          title: "Customer Satisfaction Survey",
          description: "Gather feedback from your customers",
          status: "active",
          responses: 45,
          completionRate: 78,
          createdAt: "2023-05-15",
          lastModified: "2023-06-20",
          questions: [
            {
              id: 101,
              type: "text",
              text: "What is your name?",
              description: "",
              required: true,
              options: []
            },
            {
              id: 102,
              type: "multiple",
              text: "How satisfied are you with our service?",
              description: "Please rate your overall satisfaction",
              required: true,
              options: ["Very Satisfied", "Satisfied", "Neutral", "Dissatisfied", "Very Dissatisfied"]
            },
            {
              id: 103,
              type: "rating",
              text: "Rate our product quality",
              description: "",
              required: true,
              options: []
            }
          ]
        },
        {
          id: 2,
          title: "Employee Engagement Survey",
          description: "Measure employee satisfaction and engagement",
          status: "draft",
          responses: 0,
          completionRate: 0,
          createdAt: "2023-06-10",
          lastModified: "2023-06-18",
          questions: [
            {
              id: 201,
              type: "text",
              text: "What department do you work in?",
              description: "",
              required: true,
              options: []
            },
            {
              id: 202,
              type: "multiple",
              text: "How long have you been with the company?",
              description: "",
              required: true,
              options: ["Less than 1 year", "1-3 years", "3-5 years", "5-10 years", "More than 10 years"]
            }
          ]
        },
        {
          id: 3,
          title: "Product Feedback Survey",
          description: "Collect feedback on new product features",
          status: "closed",
          responses: 120,
          completionRate: 65,
          createdAt: "2023-04-20",
          lastModified: "2023-05-30",
          questions: [
            {
              id: 301,
              type: "checkbox",
              text: "Which features do you use regularly?",
              description: "Select all that apply",
              required: true,
              options: ["Feature A", "Feature B", "Feature C", "Feature D", "Feature E"]
            },
            {
              id: 302,
              type: "scale",
              text: "How likely are you to recommend our product?",
              description: "0 = Not at all likely, 10 = Extremely likely",
              required: true,
              options: []
            }
          ]
        }
      ],
      currentFilter: 'all',
      translations: {
        en: {
          dashboard: "Dashboard",
          surveys: "Surveys",
          analytics: "Analytics",
          audience: "Audience",
          settings: "Settings",
          overview: "Overview",
          signIn: "Sign In",
          signUp: "Sign Up",
          createAccount: "Create Account",
          rememberMe: "Remember me",
          forgotPassword: "Forgot password?",
          agreeToTerms: "I agree to the terms",
          logout: "Logout",
          newSurvey: "New Survey",
          noSurveys: "No surveys yet.",
          noActivity: "No activity yet.",
          interfaceLanguage: "Interface language",
          compactMode: "Compact mode"
        },
        es: {
          dashboard: "Panel",
          surveys: "Encuestas",
          analytics: "Analíticas",
          audience: "Audiencia",
          settings: "Configuración",
          overview: "Resumen",
          signIn: "Iniciar Sesión",
          signUp: "Registrarse",
          createAccount: "Crear Cuenta",
          rememberMe: "Recordarme",
          forgotPassword: "¿Olvidaste tu contraseña?",
          agreeToTerms: "Acepto los términos",
          logout: "Cerrar Sesión",
          newSurvey: "Nueva Encuesta",
          noSurveys: "Aún no hay encuestas.",
          noActivity: "No hay actividad aún.",
          interfaceLanguage: "Idioma de interfaz",
          compactMode: "Modo compacto"
        },
        fr: {
          dashboard: "Tableau de bord",
          surveys: "Sondages",
          analytics: "Analytiques",
          audience: "Audience",
          settings: "Paramètres",
          overview: "Aperçu",
          signIn: "Se Connecter",
          signUp: "S'inscrire",
          createAccount: "Créer un Compte",
          rememberMe: "Se souvenir de moi",
          forgotPassword: "Mot de passe oublié?",
          agreeToTerms: "J'accepte les conditions",
          logout: "Se Déconnecter",
          newSurvey: "Nouveau Sondage",
          noSurveys: "Pas encore de sondages.",
          noActivity: "Aucune activité pour le moment.",
          interfaceLanguage: "Langue de l'interface",
          compactMode: "Mode compact"
        },
        de: {
          dashboard: "Dashboard",
          surveys: "Umfragen",
          analytics: "Analysen",
          audience: "Publikum",
          settings: "Einstellungen",
          overview: "Übersicht",
          signIn: "Anmelden",
          signUp: "Registrieren",
          createAccount: "Konto Erstellen",
          rememberMe: "Angemeldet bleiben",
          forgotPassword: "Passwort vergessen?",
          agreeToTerms: "Ich akzeptiere die Bedingungen",
          logout: "Abmelden",
          newSurvey: "Neue Umfrage",
          noSurveys: "Noch keine Umfragen.",
          noActivity: "Noch keine Aktivitäten.",
          interfaceLanguage: "Schnittstellensprache",
          compactMode: "Kompakter Modus"
        },
        zh: {
          dashboard: "仪表板",
          surveys: "调查",
          analytics: "分析",
          audience: "受众",
          settings: "设置",
          overview: "概览",
          signIn: "登录",
          signUp: "注册",
          createAccount: "创建账户",
          rememberMe: "记住我",
          forgotPassword: "忘记密码?",
          agreeToTerms: "我同意条款",
          logout: "退出登录",
          newSurvey: "新建调查",
          noSurveys: "尚无调查。",
          noActivity: "尚无活动。",
          interfaceLanguage: "界面语言",
          compactMode: "紧凑模式"
        }
      },
      questionSettings: {
        required: false,
        shuffle: false,
        minChars: 0,
        maxChars: 0,
        layout: "Standard",
        logic: "Always show"
      }
    };

    // Expose API to inject real data later
    window.APP = {
      setMetrics(m){
        Object.assign(state.metrics, m||{}); renderKpis();
      },
      setActivity(list){ state.activity = Array.isArray(list)? list : []; renderActivity(); },
      setResponsesSeries(cfg){ renderLine('#chart-responses', '#empty-responses', cfg); },
      setStatusSeries(cfg){ renderDoughnut('#chart-status', '#empty-status', cfg); }
    };

    // Initialize the application
    document.addEventListener('DOMContentLoaded', function() {
      // Year
      $('#year').textContent = new Date().getFullYear();
      
      // Initialize particles
      createParticles();
      
      // Track mouse position for card effects
      document.addEventListener('mousemove', (e) => {
        const cards = document.querySelectorAll('.card');
        cards.forEach(card => {
          const rect = card.getBoundingClientRect();
          const x = e.clientX - rect.left;
          const y = e.clientY - rect.top;
          
          card.style.setProperty('--mouse-x', `${x}px`);
          card.style.setProperty('--mouse-y', `${y}px`);
        });
      });

      // Tabs (Auth)
      $('#tab-login').addEventListener('click', () => switchAuth('login'));
      $('#tab-signup').addEventListener('click', () => switchAuth('signup'));
      
      // Password strength indicator
      $('#login-password').addEventListener('input', (e) => {
        const password = e.target.value;
        const strength = calculatePasswordStrength(password);
        const strengthFill = $('#password-strength-fill');
        
        // Update strength text
        $('#password-strength').textContent = `Password strength: ${strength}`;
        $('#password-strength').className = `text-xs ${getPasswordStrengthColor(strength)}`;
        
        // Update strength meter
        strengthFill.className = 'password-strength-fill';
        if (strength === 'Weak') {
          strengthFill.classList.add('strength-weak');
        } else if (strength === 'Medium') {
          strengthFill.classList.add('strength-medium');
        } else if (strength === 'Strong') {
          strengthFill.classList.add('strength-strong');
        }
      });
      
      // Auth handlers (dummy; replace with backend)
      $('#form-login').addEventListener('submit', (e)=>{
        e.preventDefault();
        const email = e.target.email.value.trim();
        const pwd = e.target.password.value.trim();
        if(!email || !pwd){ return show('#login-error'); }
        hide('#login-error');
        state.authed = true; enterApp();
      });
      
      $('#form-signup').addEventListener('submit', (e)=>{
        e.preventDefault();
        const ok = e.target.name.value && e.target.email.value && e.target.password.value && e.target.terms.checked;
        if(!ok){ return show('#signup-error'); }
        hide('#signup-error');
        state.authed = true; enterApp();
      });

      // Routing
      $$('#app [data-route]').forEach(a=>a.addEventListener('click', (ev)=>{
        ev.preventDefault(); 
        showPageTransition(() => routeTo(a.dataset.route));
      }));

      // Logout
      $('#btn-logout').addEventListener('click', ()=>{ 
        state.authed=false; 
        showPageTransition(() => {
          hide('#app'); 
          show('#auth');
        });
      });

      // Create Survey Modal
      $('#btn-create').addEventListener('click', () => {
        show('#create-survey-modal');
      });

      $('#close-create-modal').addEventListener('click', () => {
        hide('#create-survey-modal');
      });

      $('#cancel-create').addEventListener('click', () => {
        hide('#create-survey-modal');
      });

      // Survey creation method selection
      $$('.survey-option').forEach(option => {
        option.addEventListener('click', () => {
          $$('.survey-option').forEach(opt => opt.classList.remove('border-primary-400', 'bg-primary-500/10'));
          option.classList.add('border-primary-400', 'bg-primary-500/10');
          $('#confirm-create').disabled = false;
        });
      });

      $('#confirm-create').addEventListener('click', () => {
        const title = $('#survey-title').value.trim();
        const selectedMethod = $('.survey-option.border-primary-400')?.dataset.method;
        
        if (!title) {
          alert('Please enter a survey title');
          return;
        }
        
        if (!selectedMethod) {
          alert('Please select a creation method');
          return;
        }
        
        // Store survey title
        state.surveyData.title = title;
        state.surveyData.description = "Survey description";
        
        // Create a new survey object
        const newSurvey = {
          id: Date.now(),
          title: title,
          description: "New survey created",
          status: "draft",
          responses: 0,
          completionRate: 0,
          createdAt: new Date().toISOString().split('T')[0],
          lastModified: new Date().toISOString().split('T')[0],
          questions: []
        };
        
        // Add to surveys array
        state.surveys.unshift(newSurvey);
        
        // In a real app, this would create the survey via API
        console.log(`Creating survey: ${title} using method: ${selectedMethod}`);
        
        // For the "Start from Scratch" method, show the builder
        if (selectedMethod === 'blank') {
          state.currentSurveyId = newSurvey.id;
          hide('#create-survey-modal');
          showPageTransition(() => routeTo('builder'));
        } else {
          // For other methods, show share modal
          hide('#create-survey-modal');
          show('#share-survey-modal');
        }
      });

      // Share Survey Modal
      $('#close-share-modal').addEventListener('click', () => {
        hide('#share-survey-modal');
      });

      $('#done-share').addEventListener('click', () => {
        hide('#share-survey-modal');
      });

      // Copy link functionality
      $('#copy-link').addEventListener('click', (e) => {
        const linkInput = $('#survey-link');
        linkInput.select();
        document.execCommand('copy');
        
        // Show feedback
        const originalHtml = $('#copy-link').innerHTML;
        $('#copy-link').innerHTML = '<i class="fa-solid fa-check"></i>';
        setTimeout(() => {
          $('#copy-link').innerHTML = originalHtml;
        }, 2000);
        
        // Add ripple effect
        createRipple(e.currentTarget, e);
      });

      $('#copy-embed').addEventListener('click', (e) => {
        const embedInput = $('#embed-code');
        embedInput.select();
        document.execCommand('copy');
        
        // Show feedback
        const originalHtml = $('#copy-embed').innerHTML;
        $('#copy-embed').innerHTML = '<i class="fa-solid fa-check"></i>';
        setTimeout(() => {
          $('#copy-embed').innerHTML = originalHtml;
        }, 2000);
        
        // Add ripple effect
        createRipple(e.currentTarget, e);
      });

      // Language Selector
      $('#language-selector button').addEventListener('click', (e) => {
        e.stopPropagation();
        $('#language-dropdown').classList.toggle('hidden');
      });

      // Close language dropdown when clicking outside
      document.addEventListener('click', (e) => {
        if (!e.target.closest('#language-selector')) {
          $('#language-dropdown').classList.add('hidden');
        }
      });

      // Language selection
      $$('.language-option').forEach(option => {
        option.addEventListener('click', () => {
          const lang = option.dataset.lang;
          setLanguage(lang);
          $('#language-dropdown').classList.add('hidden');
        });
      });

      // Settings language change
      $('#setting-lang').addEventListener('change', (e) => {
        setLanguage(e.target.value);
      });

      // Compact mode toggle
      $('#setting-compact').addEventListener('change', (e) => {
        state.settings.compactMode = e.target.checked;
        applyCompactMode();
      });

      // Government Security Modal
      $('#enable-government-security').addEventListener('click', () => {
        show('#government-security-modal');
      });
      
      $('#enable-gov-security').addEventListener('click', () => {
        show('#government-security-modal');
      });

      $('#close-security-modal').addEventListener('click', () => {
        hide('#government-security-modal');
      });

      $('#cancel-security').addEventListener('click', () => {
        hide('#government-security-modal');
      });

      $('#save-security').addEventListener('click', () => {
        // In a real app, this would save security settings
        state.settings.governmentSecurity = true;
        
        // Add security lock animation
        const lockIcon = $('#save-security i');
        lockIcon.classList.add('security-lock');
        setTimeout(() => {
          lockIcon.classList.remove('security-lock');
        }, 500);
        
        alert('Government security settings applied successfully');
        hide('#government-security-modal');
        updateSecurityBadge();
      });

      // 2FA Enable
      $('#enable-2fa').addEventListener('click', () => {
        // In a real app, this would start the 2FA setup process
        state.settings.twoFactorAuth = true;
        
        // Add security lock animation
        const lockIcon = $('#enable-2fa i');
        lockIcon.classList.add('security-lock');
        setTimeout(() => {
          lockIcon.classList.remove('security-lock');
        }, 500);
        
        alert('Two-factor authentication has been enabled. Please check your email for setup instructions.');
        update2FABadge();
      });

      // Survey search functionality
      $('#survey-search').addEventListener('input', (e) => {
        const searchTerm = e.target.value.toLowerCase();
        renderSurveys(searchTerm, state.currentFilter);
      });

      // Filter pills functionality
      $$('.filter-pill').forEach(pill => {
        pill.addEventListener('click', () => {
          // Update active state
          $$('.filter-pill').forEach(p => p.classList.remove('active'));
          pill.classList.add('active');
          
          // Update current filter
          state.currentFilter = pill.dataset.filter;
          
          // Re-render surveys with new filter
          renderSurveys('', state.currentFilter);
        });
      });

      // Save survey
      $('#save-survey').addEventListener('click', () => {
        const questions = $$('#survey-canvas .canvas-item:not(#canvas-drop-zone)');
        const surveyData = {
          title: state.surveyData.title || 'Untitled Survey',
          description: state.surveyData.description || '',
          questions: []
        };
        
        questions.forEach(question => {
          if (question.id === 'canvas-drop-zone') return;
          
          const type = question.dataset.type;
          const text = question.querySelector('.question-text').textContent;
          
          surveyData.questions.push({
            type,
            text,
            options: type === 'multiple' || type === 'checkbox' || type === 'dropdown' ? 
              Array.from(question.querySelectorAll('.option-item label')).map(label => label.textContent) : 
              undefined
          });
        });
        
        // Check if we're updating an existing survey or creating a new one
        if (state.currentSurveyId) {
          // Update existing survey
          const surveyIndex = state.surveys.findIndex(s => s.id === state.currentSurveyId);
          if (surveyIndex !== -1) {
            state.surveys[surveyIndex] = {
              ...state.surveys[surveyIndex],
              title: surveyData.title,
              description: surveyData.description,
              lastModified: new Date().toISOString().split('T')[0],
              questions: surveyData.questions
            };
            
            // Add activity
            state.activity.unshift({
              type: 'survey',
              title: `Updated "${surveyData.title}"`,
              time: 'Just now'
            });
            renderActivity();
          }
        } else {
          // Create new survey
          const newSurvey = {
            id: Date.now(),
            title: surveyData.title,
            description: surveyData.description,
            status: "draft",
            responses: 0,
            completionRate: 0,
            createdAt: new Date().toISOString().split('T')[0],
            lastModified: new Date().toISOString().split('T')[0],
            questions: surveyData.questions
          };
          
          // Add to surveys array
          state.surveys.unshift(newSurvey);
          
          // Add activity
          state.activity.unshift({
            type: 'survey',
            title: `Created "${surveyData.title}"`,
            time: 'Just now'
          });
          renderActivity();
        }
        
        // Update metrics
        window.APP.setMetrics({
          surveys: state.surveys.length,
          responses: state.metrics.responses,
          completion: state.metrics.completion,
          active: state.metrics.active
        });
        
        console.log('Survey saved:', surveyData);
        alert('Survey saved successfully!');
        
        // Navigate to surveys page
        showPageTransition(() => routeTo('surveys'));
      });
      
      // Preview survey
      $('#preview-survey').addEventListener('click', () => {
        generatePreview();
        show('#preview-survey-modal');
      });
      
      $('#close-preview-modal').addEventListener('click', () => {
        hide('#preview-survey-modal');
      });
      
      $('#cancel-preview').addEventListener('click', () => {
        hide('#preview-survey-modal');
      });
      
      $('#submit-preview').addEventListener('click', () => {
        alert('This is just a preview. In a real application, this would submit the survey.');
        hide('#preview-survey-modal');
      });

      // Edit Question Modal
      $('#close-edit-modal').addEventListener('click', () => {
        hide('#edit-question-modal');
      });

      $('#cancel-edit').addEventListener('click', () => {
        hide('#edit-question-modal');
      });

      $('#edit-question-form').addEventListener('submit', (e) => {
        e.preventDefault();
        saveEditedQuestion();
      });

      // Add option button
      $('#add-option-btn').addEventListener('click', () => {
        addOptionField();
      });

      // Component search
      $('#component-search').addEventListener('input', (e) => {
        const searchTerm = e.target.value.toLowerCase();
        filterComponents(searchTerm);
      });

      // Initialize with sample data for demonstration
      setTimeout(() => {
        if (state.authed) {
          // Sample metrics
          window.APP.setMetrics({
            surveys: state.surveys.length,
            responses: 728,
            completion: 74,
            active: 12
          });
          
          // Sample activity
          window.APP.setActivity([
            { type: 'survey', title: 'Created "Customer Feedback Survey"', time: '2 hours ago' },
            { type: 'response', title: 'Received 15 new responses', time: '5 hours ago' },
            { type: 'share', title: 'Shared "Employee Satisfaction Survey"', time: '1 day ago' }
          ]);
          
          // Sample chart data
          window.APP.setResponsesSeries({
            labels: ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun'],
            datasets: [{
              label: 'Responses',
              data: [42, 58, 35, 67, 89, 45, 62],
              borderColor: '#6366f1',
              backgroundColor: 'rgba(99, 102, 241, 0.1)',
              tension: 0.4,
              fill: true
            }]
          });
          
          window.APP.setStatusSeries({
            labels: ['Active', 'Draft', 'Closed', 'Archived'],
            datasets: [{
              data: [3, 3, 2, 2],
              backgroundColor: [
                'rgba(99, 102, 241, 0.8)',
                'rgba(168, 85, 247, 0.8)',
                'rgba(107, 114, 128, 0.8)',
                'rgba(156, 163, 175, 0.8)'
              ]
            }]
          });
        }
      }, 1000);
    });

    // Create floating particles
    function createParticles() {
      const particlesContainer = $('#particles');
      const particleCount = 20;
      
      for (let i = 0; i < particleCount; i++) {
        const particle = document.createElement('div');
        particle.className = 'particle';
        
        // Random position
        const posX = Math.random() * 100;
        const posY = Math.random() * 100;
        
        // Random size
        const size = Math.random() * 4 + 1;
        
        // Random animation delay
        const delay = Math.random() * 10;
        
        // Set styles
        particle.style.left = `${posX}%`;
        particle.style.top = `${posY}%`;
        particle.style.width = `${size}px`;
        particle.style.height = `${size}px`;
        particle.style.animationDelay = `${delay}s`;
        
        particlesContainer.appendChild(particle);
      }
    }

    // Create ripple effect
    function createRipple(button, event) {
      const ripple = document.createElement('span');
      ripple.classList.add('ripple');
      
      const rect = button.getBoundingClientRect();
      const size = Math.max(rect.width, rect.height);
      const x = event.clientX - rect.left - size / 2;
      const y = event.clientY - rect.top - size / 2;
      
      ripple.style.width = ripple.style.height = `${size}px`;
      ripple.style.left = `${x}px`;
      ripple.style.top = `${y}px`;
      
      button.appendChild(ripple);
      
      setTimeout(() => {
        ripple.remove();
      }, 600);
    }

    // Page transition effect
    function showPageTransition(callback) {
      const pageTransition = $('#page-transition');
      pageTransition.classList.add('active');
      
      setTimeout(() => {
        if (callback) callback();
        pageTransition.classList.remove('active');
      }, 500);
    }

    // Enter app
    function enterApp(){
      hide('#auth'); show('#app'); routeTo('dashboard');
    }

    // Routing
    function routeTo(name){
      // Update page title and description
      const routeTitles = {
        dashboard: "Overview",
        surveys: "Surveys",
        share: "Share Surveys",
        builder: "Survey Builder",
        analytics: "Analytics",
        audience: "Audience Management",
        settings: "Settings"
      };
      
      const routeDescriptions = {
        dashboard: "Bring your data — we keep the UI clean.",
        surveys: "Create and manage your surveys.",
        share: "Distribute your surveys with advanced sharing options.",
        builder: "Drag and drop components to create your survey.",
        analytics: "Gain insights from your survey data.",
        audience: "Manage your survey participants.",
        settings: "Configure your account and preferences."
      };
      
      $('#route-title').textContent = routeTitles[name] || "Overview";
      $('#route-description').textContent = routeDescriptions[name] || "Bring your data — we keep the UI clean.";
      
      // nav active
      $$('#app .nav-item').forEach(n => n.classList.toggle('active', n.dataset.route===name));
      // sections
      ['dashboard','surveys','share','builder','analytics','audience','settings'].forEach(r=>{
        const el = document.getElementById('route-'+r); if(!el) return;
        el.classList.toggle('hidden', r!==name);
      });
      
      if(name==='dashboard'){ 
        ensureCharts(); 
        renderKpis(); 
        renderActivity(); 
        renderTopSurveys();
      }
      
      if(name==='surveys'){ 
        renderSurveys(); 
      }
      
      if(name==='builder'){ 
        initDragAndDrop(); 
        loadSurveyQuestions();
      }
    }

    function setLanguage(lang) {
      state.language = lang;
      
      // Update UI elements with translations
      const t = state.translations[lang];
      
      // Update navigation
      $$('[data-route="dashboard"] span').textContent = t.dashboard;
      $$('[data-route="surveys"] span').textContent = t.surveys;
      $$('[data-route="analytics"] span').textContent = t.analytics;
      $$('[data-route="audience"] span').textContent = t.audience;
      $$('[data-route="settings"] span').textContent = t.settings;
      
      // Update buttons and text
      $('#tab-login').textContent = t.signIn;
      $('#tab-signup').textContent = t.signUp;
      $('#btn-signup span').textContent = t.createAccount;
      $('#btn-logout').innerHTML = `<i class="fa-solid fa-right-from-bracket"></i> ${t.logout}`;
      $('#btn-create').innerHTML = `<i class="fa-solid fa-plus"></i> ${t.newSurvey}`;
      
      // Update form labels
      $('label[for="remember"] span').textContent = t.rememberMe;
      $('a[href="#"]').textContent = t.forgotPassword;
      $('label[for="terms"] span').textContent = t.agreeToTerms;
      
      // Update empty states
      if ($('#surveys-empty .empty p')) {
        $('#surveys-empty .empty p').textContent = t.noSurveys;
      }
      if ($('#activity .empty p')) {
        $('#activity .empty p').textContent = t.noActivity;
      }
      
      // Update settings
      $('#setting-lang').value = lang;
      $('label[for="setting-compact"] span').textContent = t.compactMode;
      $('label:has(#setting-lang) span').textContent = t.interfaceLanguage;
      
      // Update current language display
      $('#current-lang').textContent = $('.language-option[data-lang="' + lang + '"]').textContent.trim();
      $('#current-flag').className = 'fi fi-' + getCountryCode(lang) + ' rounded-sm';
    }

    function getCountryCode(lang) {
      const map = {
        'en': 'us',
        'es': 'es',
        'fr': 'fr',
        'de': 'de',
        'zh': 'cn'
      };
      return map[lang] || 'us';
    }

    function applyCompactMode() {
      if (state.settings.compactMode) {
        document.body.classList.add('compact-mode');
      } else {
        document.body.classList.remove('compact-mode');
      }
    }

    function updateSecurityBadge() {
      const badge = $('.security-badge');
      if (badge && state.settings.governmentSecurity) {
        badge.innerHTML = '<i class="fa-solid fa-shield-halved"></i> Government Security';
        badge.classList.add('bg-security-500/20', 'border-security-500/30', 'text-security-300');
      }
    }

    function update2FABadge() {
      const badge = $('#route-settings .badge');
      if (badge && state.settings.twoFactorAuth) {
        badge.textContent = 'Enabled';
        badge.classList.add('bg-security-500/20', 'border-security-500/30', 'text-security-300');
      }
    }

    function calculatePasswordStrength(password) {
      if (password.length === 0) return 'None';
      if (password.length < 8) return 'Weak';
      
      let strength = 0;
      
      // Length check
      if (password.length >= 12) strength += 1;
      
      // Complexity checks
      if (/[A-Z]/.test(password)) strength += 1; // Uppercase
      if (/[a-z]/.test(password)) strength += 1; // Lowercase
      if (/[0-9]/.test(password)) strength += 1; // Numbers
      if (/[^A-Za-z0-9]/.test(password)) strength += 1; // Special chars
      
      if (strength < 2) return 'Weak';
      if (strength < 4) return 'Medium';
      return 'Strong';
    }

    function getPasswordStrengthColor(strength) {
      switch (strength) {
        case 'Weak': return 'text-red-400';
        case 'Medium': return 'text-yellow-400';
        case 'Strong': return 'text-green-400';
        default: return 'text-ink-400';
      }
    }

    // Render surveys based on search term and filter
    function renderSurveys(searchTerm = '', filter = 'all') {
      const surveysList = $('#surveys-list');
      const surveysEmpty = $('#surveys-empty');
      
      // Filter surveys based on search term and status filter
      let filteredSurveys = state.surveys;
      
      // Apply status filter
      if (filter !== 'all') {
        filteredSurveys = filteredSurveys.filter(survey => survey.status === filter);
      }
      
      // Apply search term filter
      if (searchTerm) {
        filteredSurveys = filteredSurveys.filter(survey => 
          survey.title.toLowerCase().includes(searchTerm) || 
          survey.description.toLowerCase().includes(searchTerm)
        );
      }
      
      // Clear existing surveys
      surveysList.innerHTML = '';
      
      // Show or hide empty state
      if (filteredSurveys.length === 0) {
        surveysList.classList.add('hidden');
        surveysEmpty.classList.remove('hidden');
        return;
      }
      
      surveysList.classList.remove('hidden');
      surveysEmpty.classList.add('hidden');
      
      // Render survey cards
      filteredSurveys.forEach((survey, index) => {
        const statusClass = `status-${survey.status}`;
        const statusText = survey.status.charAt(0).toUpperCase() + survey.status.slice(1);
        
        const surveyCard = document.createElement('div');
        surveyCard.className = 'survey-card';
        surveyCard.style.animationDelay = `${index * 0.05}s`;
        surveyCard.innerHTML = `
          <div class="survey-card-header">
            <div>
              <h3 class="survey-card-title">${survey.title}</h3>
              <p class="text-sm text-ink-400">${survey.description}</p>
              <div class="survey-card-meta">
                <span><i class="far fa-calendar"></i> Created: ${formatDate(survey.createdAt)}</span>
                <span><i class="far fa-clock"></i> Modified: ${formatDate(survey.lastModified)}</span>
              </div>
            </div>
            <div class="survey-status ${statusClass}">
              <i class="fas fa-circle text-xs"></i> ${statusText}
            </div>
          </div>
          <div class="flex justify-between items-center mt-4">
            <div>
              <div class="text-sm text-ink-400">
                <span class="font-semibold">${survey.responses}</span> responses
                <span class="mx-2">•</span>
                <span class="font-semibold">${survey.completionRate}%</span> completion
              </div>
              <div class="survey-progress mt-2">
                <div class="survey-progress-bar" style="width: ${survey.completionRate}%"></div>
              </div>
            </div>
            <div class="survey-card-actions">
              <button class="btn btn-ghost" onclick="editSurvey(${survey.id})" title="Edit">
                <i class="fas fa-edit"></i>
              </button>
              <button class="btn btn-ghost" onclick="shareSurvey(${survey.id})" title="Share">
                <i class="fas fa-share-alt"></i>
              </button>
              <button class="btn btn-ghost" onclick="duplicateSurvey(${survey.id})" title="Duplicate">
                <i class="fas fa-copy"></i>
              </button>
              <button class="btn btn-ghost" onclick="deleteSurvey(${survey.id})" title="Delete">
                <i class="fas fa-trash"></i>
              </button>
            </div>
          </div>
        `;
        
        surveysList.appendChild(surveyCard);
      });
    }

    // Format date for display
    function formatDate(dateString) {
      const date = new Date(dateString);
      const options = { year: 'numeric', month: 'short', day: 'numeric' };
      return date.toLocaleDateString(undefined, options);
    }

    // Filter components based on search term
    function filterComponents(searchTerm) {
      const componentItems = $$('.component-item');
      
      componentItems.forEach(item => {
        const text = item.textContent.toLowerCase();
        if (text.includes(searchTerm)) {
          item.style.display = 'flex';
        } else {
          item.style.display = 'none';
        }
      });
      
      // Show/hide categories based on visible items
      const categories = $$('.component-category');
      categories.forEach(category => {
        const visibleItems = category.querySelectorAll('.component-item[style="display: flex"]');
        if (visibleItems.length === 0) {
          category.style.display = 'none';
        } else {
          category.style.display = 'block';
        }
      });
    }

    // Drag and Drop Functionality
    function initDragAndDrop() {
      const components = $$('.component-item');
      const canvas = $('#survey-canvas');
      const dropZone = $('#canvas-drop-zone');
      
      // Component drag start
      components.forEach(component => {
        component.addEventListener('dragstart', (e) => {
          e.dataTransfer.setData('text/plain', component.dataset.type);
          component.classList.add('opacity-50');
          dropZone.classList.add('active');
          
          // Create ghost image
          const ghost = component.cloneNode(true);
          ghost.classList.add('drag-ghost');
          document.body.appendChild(ghost);
          e.dataTransfer.setDragImage(ghost, e.offsetX, e.offsetY);
          setTimeout(() => document.body.removeChild(ghost), 0);
        });
        
        component.addEventListener('dragend', () => {
          components.forEach(c => c.classList.remove('opacity-50'));
          dropZone.classList.remove('active');
        });
      });
      
      // Canvas drag over
      canvas.addEventListener('dragover', (e) => {
        e.preventDefault();
        canvas.classList.add('drag-over');
        
        // Find the position to insert the new element
        const afterElement = getDragAfterElement(canvas, e.clientY);
        const dragging = document.querySelector('.dragging');
        
        if (afterElement == null) {
          canvas.appendChild(dropZone);
        } else {
          canvas.insertBefore(dropZone, afterElement);
        }
      });
      
      canvas.addEventListener('dragleave', () => {
        canvas.classList.remove('drag-over');
      });
      
      // Canvas drop
      canvas.addEventListener('drop', (e) => {
        e.preventDefault();
        canvas.classList.remove('drag-over');
        
        const type = e.dataTransfer.getData('text/plain');
        
        // Create a new question based on the type
        createNewQuestion(type);
        
        // Hide drop zone if there are items other than the drop zone
        if (canvas.querySelectorAll('.canvas-item:not(#canvas-drop-zone)').length > 0) {
          dropZone.classList.add('hidden');
        }
      });
      
      // Canvas item drag start
      canvas.addEventListener('dragstart', (e) => {
        if (e.target.classList.contains('canvas-item') || e.target.closest('.canvas-item')) {
          const canvasItem = e.target.classList.contains('canvas-item') ? e.target : e.target.closest('.canvas-item');
          canvasItem.classList.add('dragging');
          e.dataTransfer.effectAllowed = 'move';
          e.dataTransfer.setData('text/html', canvasItem.innerHTML);
          e.dataTransfer.setData('text/plain', canvasItem.dataset.id);
        }
      });
      
      // Canvas item drag end
      canvas.addEventListener('dragend', (e) => {
        if (e.target.classList.contains('canvas-item') || e.target.closest('.canvas-item')) {
          const canvasItem = e.target.classList.contains('canvas-item') ? e.target : e.target.closest('.canvas-item');
          canvasItem.classList.remove('dragging');
        }
      });
      
      // Canvas item drag over
      canvas.addEventListener('dragover', (e) => {
        e.preventDefault();
        const dragging = document.querySelector('.dragging');
        const afterElement = getDragAfterElement(canvas, e.clientY);
        
        if (afterElement == null) {
          canvas.appendChild(dragging);
        } else {
          canvas.insertBefore(dragging, afterElement);
        }
      });
    }
    
    function getDragAfterElement(container, y) {
      const draggableElements = [...container.querySelectorAll('.canvas-item:not(.dragging):not(#canvas-drop-zone)')];
      
      return draggableElements.reduce((closest, child) => {
        const box = child.getBoundingClientRect();
        const offset = y - box.top - box.height / 2;
        
        if (offset < 0 && offset > closest.offset) {
          return { offset: offset, element: child };
        } else {
          return closest;
        }
      }, { offset: Number.NEGATIVE_INFINITY }).element;
    }
    
    function createNewQuestion(type) {
      const canvas = $('#survey-canvas');
      const dropZone = $('#canvas-drop-zone');
      const questionId = Date.now();
      
      let questionHTML = '';
      const questionText = 'New Question';
      
      switch(type) {
        case 'text':
          questionHTML = `
            <div class="canvas-item" data-type="text" data-id="${questionId}" draggable="true">
              <div class="item-controls">
                <div class="control-btn" onclick="editQuestion('${questionId}')"><i class="fa-solid fa-pen fa-xs"></i></div>
                <div class="control-btn" onclick="openQuestionSettings('${questionId}')"><i class="fa-solid fa-gear fa-xs"></i></div>
                <div class="control-btn" onclick="deleteQuestion('${questionId}')"><i class="fa-solid fa-trash fa-xs"></i></div>
              </div>
              <div class="question-preview">
                <div class="question-text">${questionText}</div>
                <div class="question-type">Text Question</div>
                <input type="text" class="field w-full mt-2" placeholder="Type your answer here" disabled>
              </div>
            </div>
          `;
          break;
          
        case 'multiple':
          questionHTML = `
            <div class="canvas-item" data-type="multiple" data-id="${questionId}" draggable="true">
              <div class="item-controls">
                <div class="control-btn" onclick="editQuestion('${questionId}')"><i class="fa-solid fa-pen fa-xs"></i></div>
                <div class="control-btn" onclick="openQuestionSettings('${questionId}')"><i class="fa-solid fa-gear fa-xs"></i></div>
                <div class="control-btn" onclick="deleteQuestion('${questionId}')"><i class="fa-solid fa-trash fa-xs"></i></div>
              </div>
              <div class="question-preview">
                <div class="question-text">${questionText}</div>
                <div class="question-type">Multiple Choice</div>
                <div class="space-y-2 mt-2">
                  <div class="flex items-center gap-2">
                    <input type="radio" disabled class="rounded-full">
                    <label class="text-sm">Option 1</label>
                  </div>
                  <div class="flex items-center gap-2">
                    <input type="radio" disabled class="rounded-full">
                    <label class="text-sm">Option 2</label>
                  </div>
                  <div class="flex items-center gap-2">
                    <input type="radio" disabled class="rounded-full">
                    <label class="text-sm">Option 3</label>
                  </div>
                </div>
              </div>
            </div>
          `;
          break;
          
        case 'checkbox':
          questionHTML = `
            <div class="canvas-item" data-type="checkbox" data-id="${questionId}" draggable="true">
              <div class="item-controls">
                <div class="control-btn" onclick="editQuestion('${questionId}')"><i class="fa-solid fa-pen fa-xs"></i></div>
                <div class="control-btn" onclick="openQuestionSettings('${questionId}')"><i class="fa-solid fa-gear fa-xs"></i></div>
                <div class="control-btn" onclick="deleteQuestion('${questionId}')"><i class="fa-solid fa-trash fa-xs"></i></div>
              </div>
              <div class="question-preview">
                <div class="question-text">${questionText}</div>
                <div class="question-type">Checkboxes</div>
                <div class="space-y-2 mt-2">
                  <div class="flex items-center gap-2">
                    <input type="checkbox" disabled class="rounded">
                    <label class="text-sm">Option 1</label>
                  </div>
                  <div class="flex items-center gap-2">
                    <input type="checkbox" disabled class="rounded">
                    <label class="text-sm">Option 2</label>
                  </div>
                  <div class="flex items-center gap-2">
                    <input type="checkbox" disabled class="rounded">
                    <label class="text-sm">Option 3</label>
                  </div>
                </div>
              </div>
            </div>
          `;
          break;
          
        case 'dropdown':
          questionHTML = `
            <div class="canvas-item" data-type="dropdown" data-id="${questionId}" draggable="true">
              <div class="item-controls">
                <div class="control-btn" onclick="editQuestion('${questionId}')"><i class="fa-solid fa-pen fa-xs"></i></div>
                <div class="control-btn" onclick="openQuestionSettings('${questionId}')"><i class="fa-solid fa-gear fa-xs"></i></div>
                <div class="control-btn" onclick="deleteQuestion('${questionId}')"><i class="fa-solid fa-trash fa-xs"></i></div>
              </div>
              <div class="question-preview">
                <div class="question-text">${questionText}</div>
                <div class="question-type">Dropdown</div>
                <select class="field w-full mt-2" disabled>
                  <option>Option 1</option>
                  <option>Option 2</option>
                  <option>Option 3</option>
                </select>
              </div>
            </div>
          `;
          break;
          
        case 'rating':
          questionHTML = `
            <div class="canvas-item" data-type="rating" data-id="${questionId}" draggable="true">
              <div class="item-controls">
                <div class="control-btn" onclick="editQuestion('${questionId}')"><i class="fa-solid fa-pen fa-xs"></i></div>
                <div class="control-btn" onclick="openQuestionSettings('${questionId}')"><i class="fa-solid fa-gear fa-xs"></i></div>
                <div class="control-btn" onclick="deleteQuestion('${questionId}')"><i class="fa-solid fa-trash fa-xs"></i></div>
              </div>
              <div class="question-preview">
                <div class="question-text">${questionText}</div>
                <div class="question-type">Rating</div>
                <div class="rating-container mt-2">
                  <span class="rating-star active"><i class="fa-solid fa-star"></i></span>
                  <span class="rating-star active"><i class="fa-solid fa-star"></i></span>
                  <span class="rating-star active"><i class="fa-solid fa-star"></i></span>
                  <span class="rating-star active"><i class="fa-solid fa-star"></i></span>
                  <span class="rating-star"><i class="fa-solid fa-star"></i></span>
                </div>
              </div>
            </div>
          `;
          break;
          
        case 'date':
          questionHTML = `
            <div class="canvas-item" data-type="date" data-id="${questionId}" draggable="true">
              <div class="item-controls">
                <div class="control-btn" onclick="editQuestion('${questionId}')"><i class="fa-solid fa-pen fa-xs"></i></div>
                <div class="control-btn" onclick="openQuestionSettings('${questionId}')"><i class="fa-solid fa-gear fa-xs"></i></div>
                <div class="control-btn" onclick="deleteQuestion('${questionId}')"><i class="fa-solid fa-trash fa-xs"></i></div>
              </div>
              <div class="question-preview">
                <div class="question-text">${questionText}</div>
                <div class="question-type">Date Picker</div>
                <input type="date" class="field w-full mt-2" disabled>
              </div>
            </div>
          `;
          break;
          
        case 'scale':
          questionHTML = `
            <div class="canvas-item" data-type="scale" data-id="${questionId}" draggable="true">
              <div class="item-controls">
                <div class="control-btn" onclick="editQuestion('${questionId}')"><i class="fa-solid fa-pen fa-xs"></i></div>
                <div class="control-btn" onclick="openQuestionSettings('${questionId}')"><i class="fa-solid fa-gear fa-xs"></i></div>
                <div class="control-btn" onclick="deleteQuestion('${questionId}')"><i class="fa-solid fa-trash fa-xs"></i></div>
              </div>
              <div class="question-preview">
                <div class="question-text">${questionText}</div>
                <div class="question-type">Linear Scale</div>
                <div class="scale-container mt-2">
                  <div class="scale-point">
                    <input type="radio" disabled>
                    <div class="scale-label">1</div>
                  </div>
                  <div class="scale-point">
                    <input type="radio" disabled>
                    <div class="scale-label">2</div>
                  </div>
                  <div class="scale-point">
                    <input type="radio" disabled>
                    <div class="scale-label">3</div>
                  </div>
                  <div class="scale-point">
                    <input type="radio" disabled>
                    <div class="scale-label">4</div>
                  </div>
                  <div class="scale-point">
                    <input type="radio" disabled>
                    <div class="scale-label">5</div>
                  </div>
                </div>
              </div>
            </div>
          `;
          break;
          
        case 'file':
          questionHTML = `
            <div class="canvas-item" data-type="file" data-id="${questionId}" draggable="true">
              <div class="item-controls">
                <div class="control-btn" onclick="editQuestion('${questionId}')"><i class="fa-solid fa-pen fa-xs"></i></div>
                <div class="control-btn" onclick="openQuestionSettings('${questionId}')"><i class="fa-solid fa-gear fa-xs"></i></div>
                <div class="control-btn" onclick="deleteQuestion('${questionId}')"><i class="fa-solid fa-trash fa-xs"></i></div>
              </div>
              <div class="question-preview">
                <div class="question-text">${questionText}</div>
                <div class="question-type">File Upload</div>
                <div class="mt-2">
                  <button class="btn btn-ghost w-full" disabled>
                    <i class="fa-solid fa-upload"></i> Upload File
                  </button>
                </div>
              </div>
            </div>
          `;
          break;
          
        case 'section':
          questionHTML = `
            <div class="canvas-item" data-type="section" data-id="${questionId}" draggable="true">
              <div class="item-controls">
                <div class="control-btn" onclick="editQuestion('${questionId}')"><i class="fa-solid fa-pen fa-xs"></i></div>
                <div class="control-btn" onclick="openQuestionSettings('${questionId}')"><i class="fa-solid fa-gear fa-xs"></i></div>
                <div class="control-btn" onclick="deleteQuestion('${questionId}')"><i class="fa-solid fa-trash fa-xs"></i></div>
              </div>
              <div class="question-preview">
                <div class="question-text">${questionText}</div>
                <div class="question-type">Section Header</div>
                <p class="text-sm text-ink-400 mt-2">Section description goes here</p>
              </div>
            </div>
          `;
          break;
          
        case 'matrix':
          questionHTML = `
            <div class="canvas-item" data-type="matrix" data-id="${questionId}" draggable="true">
              <div class="item-controls">
                <div class="control-btn" onclick="editQuestion('${questionId}')"><i class="fa-solid fa-pen fa-xs"></i></div>
                <div class="control-btn" onclick="openQuestionSettings('${questionId}')"><i class="fa-solid fa-gear fa-xs"></i></div>
                <div class="control-btn" onclick="deleteQuestion('${questionId}')"><i class="fa-solid fa-trash fa-xs"></i></div>
              </div>
              <div class="question-preview">
                <div class="question-text">${questionText}</div>
                <div class="question-type">Matrix Table</div>
                <div class="mt-2">
                  <table class="w-full text-sm">
                    <thead>
                      <tr>
                        <th></th>
                        <th>Option 1</th>
                        <th>Option 2</th>
                        <th>Option 3</th>
                      </tr>
                    </thead>
                    <tbody>
                      <tr>
                        <td>Row 1</td>
                        <td><input type="radio" disabled></td>
                        <td><input type="radio" disabled></td>
                        <td><input type="radio" disabled></td>
                      </tr>
                      <tr>
                        <td>Row 2</td>
                        <td><input type="radio" disabled></td>
                        <td><input type="radio" disabled></td>
                        <td><input type="radio" disabled></td>
                      </tr>
                    </tbody>
                  </table>
                </div>
              </div>
            </div>
          `;
          break;
          
        case 'ranking':
          questionHTML = `
            <div class="canvas-item" data-type="ranking" data-id="${questionId}" draggable="true">
              <div class="item-controls">
                <div class="control-btn" onclick="editQuestion('${questionId}')"><i class="fa-solid fa-pen fa-xs"></i></div>
                <div class="control-btn" onclick="openQuestionSettings('${questionId}')"><i class="fa-solid fa-gear fa-xs"></i></div>
                <div class="control-btn" onclick="deleteQuestion('${questionId}')"><i class="fa-solid fa-trash fa-xs"></i></div>
              </div>
              <div class="question-preview">
                <div class="question-text">${questionText}</div>
                <div class="question-type">Ranking</div>
                <div class="mt-2 space-y-2">
                  <div class="flex items-center gap-2">
                    <span class="text-sm">1.</span>
                    <input type="text" class="field flex-1" disabled value="Option 1">
                  </div>
                  <div class="flex items-center gap-2">
                    <span class="text-sm">2.</span>
                    <input type="text" class="field flex-1" disabled value="Option 2">
                  </div>
                  <div class="flex items-center gap-2">
                    <span class="text-sm">3.</span>
                    <input type="text" class="field flex-1" disabled value="Option 3">
                  </div>
                </div>
              </div>
            </div>
          `;
          break;
          
        case 'nps':
          questionHTML = `
            <div class="canvas-item" data-type="nps" data-id="${questionId}" draggable="true">
              <div class="item-controls">
                <div class="control-btn" onclick="editQuestion('${questionId}')"><i class="fa-solid fa-pen fa-xs"></i></div>
                <div class="control-btn" onclick="openQuestionSettings('${questionId}')"><i class="fa-solid fa-gear fa-xs"></i></div>
                <div class="control-btn" onclick="deleteQuestion('${questionId}')"><i class="fa-solid fa-trash fa-xs"></i></div>
              </div>
              <div class="question-preview">
                <div class="question-text">${questionText}</div>
                <div class="question-type">NPS Score</div>
                <div class="mt-2">
                  <div class="flex justify-between text-sm mb-1">
                    <span>Not at all likely</span>
                    <span>Extremely likely</span>
                  </div>
                  <div class="flex justify-between">
                    ${[0,1,2,3,4,5,6,7,8,9,10].map(num => `
                      <div class="text-center">
                        <input type="radio" name="nps-${questionId}" disabled class="mx-auto">
                        <div class="text-xs mt-1">${num}</div>
                      </div>
                    `).join('')}
                  </div>
                </div>
              </div>
            </div>
          `;
          break;
          
        default:
          questionHTML = `
            <div class="canvas-item" data-type="${type}" data-id="${questionId}" draggable="true">
              <div class="item-controls">
                <div class="control-btn" onclick="editQuestion('${questionId}')"><i class="fa-solid fa-pen fa-xs"></i></div>
                <div class="control-btn" onclick="openQuestionSettings('${questionId}')"><i class="fa-solid fa-gear fa-xs"></i></div>
                <div class="control-btn" onclick="deleteQuestion('${questionId}')"><i class="fa-solid fa-trash fa-xs"></i></div>
              </div>
              <div class="question-preview">
                <div class="question-text">${questionText}</div>
                <div class="question-type">${type.charAt(0).toUpperCase() + type.slice(1)} Question</div>
                <div class="mt-2 text-sm text-ink-400">Question preview would appear here</div>
              </div>
            </div>
          `;
      }
      
      // Insert before the drop zone
      dropZone.insertAdjacentHTML('beforebegin', questionHTML);
      
      // Add to survey data
      if (!state.surveyData.questions) {
        state.surveyData.questions = [];
      }
      
      state.surveyData.questions.push({
        id: questionId,
        type: type,
        text: questionText,
        description: '',
        required: false,
        options: []
      });
    }
    
    // Load survey questions into the builder
    function loadSurveyQuestions() {
      const canvas = $('#survey-canvas');
      const dropZone = $('#canvas-drop-zone');
      
      // Clear existing questions (except drop zone)
      const existingQuestions = canvas.querySelectorAll('.canvas-item:not(#canvas-drop-zone)');
      existingQuestions.forEach(q => q.remove());
      
      // If we are editing an existing survey and it has questions
      if (state.currentSurveyId) {
        const survey = state.surveys.find(s => s.id === state.currentSurveyId);
        if (survey && survey.questions && survey.questions.length > 0) {
          survey.questions.forEach((question, index) => {
            // Create question HTML based on type
            let questionHTML = '';
            const questionId = question.id || Date.now() + Math.random();
            
            switch(question.type) {
              case 'text':
                questionHTML = `
                  <div class="canvas-item" data-type="text" data-id="${questionId}" draggable="true" style="animation-delay: ${index * 0.05}s">
                    <div class="item-controls">
                      <div class="control-btn" onclick="editQuestion('${questionId}')"><i class="fa-solid fa-pen fa-xs"></i></div>
                      <div class="control-btn" onclick="openQuestionSettings('${questionId}')"><i class="fa-solid fa-gear fa-xs"></i></div>
                      <div class="control-btn" onclick="deleteQuestion('${questionId}')"><i class="fa-solid fa-trash fa-xs"></i></div>
                    </div>
                    <div class="question-preview">
                      <div class="question-text">${question.text}</div>
                      <div class="question-type">Text Question</div>
                      <input type="text" class="field w-full mt-2" placeholder="Type your answer here" disabled>
                    </div>
                  </div>
                `;
                break;
                
              case 'multiple':
                let optionsHTML = '';
                if (question.options && question.options.length) {
                  optionsHTML = question.options.map(opt => `
                    <div class="flex items-center gap-2">
                      <input type="radio" disabled class="rounded-full">
                      <label class="text-sm">${opt}</label>
                    </div>
                  `).join('');
                } else {
                  optionsHTML = `
                    <div class="flex items-center gap-2">
                      <input type="radio" disabled class="rounded-full">
                      <label class="text-sm">Option 1</label>
                    </div>
                    <div class="flex items-center gap-2">
                      <input type="radio" disabled class="rounded-full">
                      <label class="text-sm">Option 2</label>
                    </div>
                    <div class="flex items-center gap-2">
                      <input type="radio" disabled class="rounded-full">
                      <label class="text-sm">Option 3</label>
                    </div>
                  `;
                }
                
                questionHTML = `
                  <div class="canvas-item" data-type="multiple" data-id="${questionId}" draggable="true" style="animation-delay: ${index * 0.05}s">
                    <div class="item-controls">
                      <div class="control-btn" onclick="editQuestion('${questionId}')"><i class="fa-solid fa-pen fa-xs"></i></div>
                      <div class="control-btn" onclick="openQuestionSettings('${questionId}')"><i class="fa-solid fa-gear fa-xs"></i></div>
                      <div class="control-btn" onclick="deleteQuestion('${questionId}')"><i class="fa-solid fa-trash fa-xs"></i></div>
                    </div>
                    <div class="question-preview">
                      <div class="question-text">${question.text}</div>
                      <div class="question-type">Multiple Choice</div>
                      <div class="space-y-2 mt-2">
                        ${optionsHTML}
                      </div>
                    </div>
                  </div>
                `;
                break;
                
              case 'checkbox':
                let checkboxOptionsHTML = '';
                if (question.options && question.options.length) {
                  checkboxOptionsHTML = question.options.map(opt => `
                    <div class="flex items-center gap-2">
                      <input type="checkbox" disabled class="rounded">
                      <label class="text-sm">${opt}</label>
                    </div>
                  `).join('');
                } else {
                  checkboxOptionsHTML = `
                    <div class="flex items-center gap-2">
                      <input type="checkbox" disabled class="rounded">
                      <label class="text-sm">Option 1</label>
                    </div>
                    <div class="flex items-center gap-2">
                      <input type="checkbox" disabled class="rounded">
                      <label class="text-sm">Option 2</label>
                    </div>
                    <div class="flex items-center gap-2">
                      <input type="checkbox" disabled class="rounded">
                      <label class="text-sm">Option 3</label>
                    </div>
                  `;
                }
                
                questionHTML = `
                  <div class="canvas-item" data-type="checkbox" data-id="${questionId}" draggable="true" style="animation-delay: ${index * 0.05}s">
                    <div class="item-controls">
                      <div class="control-btn" onclick="editQuestion('${questionId}')"><i class="fa-solid fa-pen fa-xs"></i></div>
                      <div class="control-btn" onclick="openQuestionSettings('${questionId}')"><i class="fa-solid fa-gear fa-xs"></i></div>
                      <div class="control-btn" onclick="deleteQuestion('${questionId}')"><i class="fa-solid fa-trash fa-xs"></i></div>
                    </div>
                    <div class="question-preview">
                      <div class="question-text">${question.text}</div>
                      <div class="question-type">Checkboxes</div>
                      <div class="space-y-2 mt-2">
                        ${checkboxOptionsHTML}
                      </div>
                    </div>
                  </div>
                `;
                break;
                
              case 'dropdown':
                let dropdownOptionsHTML = '';
                if (question.options && question.options.length) {
                  dropdownOptionsHTML = question.options.map(opt => 
                    `<option>${opt}</option>`
                  ).join('');
                } else {
                  dropdownOptionsHTML = `
                    <option>Option 1</option>
                    <option>Option 2</option>
                    <option>Option 3</option>
                  `;
                }
                
                questionHTML = `
                  <div class="canvas-item" data-type="dropdown" data-id="${questionId}" draggable="true" style="animation-delay: ${index * 0.05}s">
                    <div class="item-controls">
                      <div class="control-btn" onclick="editQuestion('${questionId}')"><i class="fa-solid fa-pen fa-xs"></i></div>
                      <div class="control-btn" onclick="openQuestionSettings('${questionId}')"><i class="fa-solid fa-gear fa-xs"></i></div>
                      <div class="control-btn" onclick="deleteQuestion('${questionId}')"><i class="fa-solid fa-trash fa-xs"></i></div>
                    </div>
                    <div class="question-preview">
                      <div class="question-text">${question.text}</div>
                      <div class="question-type">Dropdown</div>
                      <select class="field w-full mt-2" disabled>
                        ${dropdownOptionsHTML}
                      </select>
                    </div>
                  </div>
                `;
                break;
                
              case 'rating':
                questionHTML = `
                  <div class="canvas-item" data-type="rating" data-id="${questionId}" draggable="true" style="animation-delay: ${index * 0.05}s">
                    <div class="item-controls">
                      <div class="control-btn" onclick="editQuestion('${questionId}')"><i class="fa-solid fa-pen fa-xs"></i></div>
                      <div class="control-btn" onclick="openQuestionSettings('${questionId}')"><i class="fa-solid fa-gear fa-xs"></i></div>
                      <div class="control-btn" onclick="deleteQuestion('${questionId}')"><i class="fa-solid fa-trash fa-xs"></i></div>
                    </div>
                    <div class="question-preview">
                      <div class="question-text">${question.text}</div>
                      <div class="question-type">Rating</div>
                      <div class="rating-container mt-2">
                        <span class="rating-star active"><i class="fa-solid fa-star"></i></span>
                        <span class="rating-star active"><i class="fa-solid fa-star"></i></span>
                        <span class="rating-star active"><i class="fa-solid fa-star"></i></span>
                        <span class="rating-star active"><i class="fa-solid fa-star"></i></span>
                        <span class="rating-star"><i class="fa-solid fa-star"></i></span>
                      </div>
                    </div>
                  </div>
                `;
                break;
                
              case 'date':
                questionHTML = `
                  <div class="canvas-item" data-type="date" data-id="${questionId}" draggable="true" style="animation-delay: ${index * 0.05}s">
                    <div class="item-controls">
                      <div class="control-btn" onclick="editQuestion('${questionId}')"><i class="fa-solid fa-pen fa-xs"></i></div>
                      <div class="control-btn" onclick="openQuestionSettings('${questionId}')"><i class="fa-solid fa-gear fa-xs"></i></div>
                      <div class="control-btn" onclick="deleteQuestion('${questionId}')"><i class="fa-solid fa-trash fa-xs"></i></div>
                    </div>
                    <div class="question-preview">
                      <div class="question-text">${question.text}</div>
                      <div class="question-type">Date Picker</div>
                      <input type="date" class="field w-full mt-2" disabled>
                    </div>
                  </div>
                `;
                break;
                
              case 'scale':
                questionHTML = `
                  <div class="canvas-item" data-type="scale" data-id="${questionId}" draggable="true" style="animation-delay: ${index * 0.05}s">
                    <div class="item-controls">
                      <div class="control-btn" onclick="editQuestion('${questionId}')"><i class="fa-solid fa-pen fa-xs"></i></div>
                      <div class="control-btn" onclick="openQuestionSettings('${questionId}')"><i class="fa-solid fa-gear fa-xs"></i></div>
                      <div class="control-btn" onclick="deleteQuestion('${questionId}')"><i class="fa-solid fa-trash fa-xs"></i></div>
                    </div>
                    <div class="question-preview">
                      <div class="question-text">${question.text}</div>
                      <div class="question-type">Linear Scale</div>
                      <div class="scale-container mt-2">
                        <div class="scale-point">
                          <input type="radio" disabled>
                          <div class="scale-label">1</div>
                        </div>
                        <div class="scale-point">
                          <input type="radio" disabled>
                          <div class="scale-label">2</div>
                        </div>
                        <div class="scale-point">
                          <input type="radio" disabled>
                          <div class="scale-label">3</div>
                        </div>
                        <div class="scale-point">
                          <input type="radio" disabled>
                          <div class="scale-label">4</div>
                        </div>
                        <div class="scale-point">
                          <input type="radio" disabled>
                          <div class="scale-label">5</div>
                        </div>
                      </div>
                    </div>
                  </div>
                `;
                break;
                
              case 'file':
                questionHTML = `
                  <div class="canvas-item" data-type="file" data-id="${questionId}" draggable="true" style="animation-delay: ${index * 0.05}s">
                    <div class="item-controls">
                      <div class="control-btn" onclick="editQuestion('${questionId}')"><i class="fa-solid fa-pen fa-xs"></i></div>
                      <div class="control-btn" onclick="openQuestionSettings('${questionId}')"><i class="fa-solid fa-gear fa-xs"></i></div>
                      <div class="control-btn" onclick="deleteQuestion('${questionId}')"><i class="fa-solid fa-trash fa-xs"></i></div>
                    </div>
                    <div class="question-preview">
                      <div class="question-text">${question.text}</div>
                      <div class="question-type">File Upload</div>
                      <div class="mt-2">
                        <button class="btn btn-ghost w-full" disabled>
                          <i class="fa-solid fa-upload"></i> Upload File
                        </button>
                      </div>
                    </div>
                  </div>
                `;
                break;
                
              case 'section':
                questionHTML = `
                  <div class="canvas-item" data-type="section" data-id="${questionId}" draggable="true" style="animation-delay: ${index * 0.05}s">
                    <div class="item-controls">
                      <div class="control-btn" onclick="editQuestion('${questionId}')"><i class="fa-solid fa-pen fa-xs"></i></div>
                      <div class="control-btn" onclick="openQuestionSettings('${questionId}')"><i class="fa-solid fa-gear fa-xs"></i></div>
                      <div class="control-btn" onclick="deleteQuestion('${questionId}')"><i class="fa-solid fa-trash fa-xs"></i></div>
                    </div>
                    <div class="question-preview">
                      <div class="question-text">${question.text}</div>
                      <div class="question-type">Section Header</div>
                      <p class="text-sm text-ink-400 mt-2">Section description goes here</p>
                    </div>
                  </div>
                `;
                break;
                
              case 'matrix':
                let matrixHTML = '';
                if (question.matrixRows && question.matrixColumns) {
                  matrixHTML = `
                    <table class="w-full text-sm">
                      <thead>
                        <tr>
                          <th></th>
                          ${question.matrixColumns.map(col => `<th>${col}</th>`).join('')}
                        </tr>
                      </thead>
                      <tbody>
                        ${question.matrixRows.map(row => `
                          <tr>
                            <td>${row}</td>
                            ${question.matrixColumns.map(() => '<td><input type="radio" disabled></td>').join('')}
                          </tr>
                        `).join('')}
                      </tbody>
                    </table>
                  `;
                } else {
                  matrixHTML = `
                    <table class="w-full text-sm">
                      <thead>
                        <tr>
                          <th></th>
                          <th>Option 1</th>
                          <th>Option 2</th>
                          <th>Option 3</th>
                        </tr>
                      </thead>
                      <tbody>
                        <tr>
                          <td>Row 1</td>
                          <td><input type="radio" disabled></td>
                          <td><input type="radio" disabled></td>
                          <td><input type="radio" disabled></td>
                        </tr>
                        <tr>
                          <td>Row 2</td>
                          <td><input type="radio" disabled></td>
                          <td><input type="radio" disabled></td>
                          <td><input type="radio" disabled></td>
                        </tr>
                      </tbody>
                    </table>
                  `;
                }
                
                questionHTML = `
                  <div class="canvas-item" data-type="matrix" data-id="${questionId}" draggable="true" style="animation-delay: ${index * 0.05}s">
                    <div class="item-controls">
                      <div class="control-btn" onclick="editQuestion('${questionId}')"><i class="fa-solid fa-pen fa-xs"></i></div>
                      <div class="control-btn" onclick="openQuestionSettings('${questionId}')"><i class="fa-solid fa-gear fa-xs"></i></div>
                      <div class="control-btn" onclick="deleteQuestion('${questionId}')"><i class="fa-solid fa-trash fa-xs"></i></div>
                    </div>
                    <div class="question-preview">
                      <div class="question-text">${question.text}</div>
                      <div class="question-type">Matrix Table</div>
                      <div class="mt-2">
                        ${matrixHTML}
                      </div>
                    </div>
                  </div>
                `;
                break;
                
              case 'ranking':
                let rankingHTML = '';
                if (question.options && question.options.length) {
                  rankingHTML = question.options.map((opt, index) => `
                    <div class="flex items-center gap-2">
                      <span class="text-sm">${index + 1}.</span>
                      <input type="text" class="field flex-1" disabled value="${opt}">
                    </div>
                  `).join('');
                } else {
                  rankingHTML = `
                    <div class="flex items-center gap-2">
                      <span class="text-sm">1.</span>
                      <input type="text" class="field flex-1" disabled value="Option 1">
                    </div>
                    <div class="flex items-center gap-2">
                      <span class="text-sm">2.</span>
                      <input type="text" class="field flex-1" disabled value="Option 2">
                    </div>
                    <div class="flex items-center gap-2">
                      <span class="text-sm">3.</span>
                      <input type="text" class="field flex-1" disabled value="Option 3">
                    </div>
                  `;
                }
                
                questionHTML = `
                  <div class="canvas-item" data-type="ranking" data-id="${questionId}" draggable="true" style="animation-delay: ${index * 0.05}s">
                    <div class="item-controls">
                      <div class="control-btn" onclick="editQuestion('${questionId}')"><i class="fa-solid fa-pen fa-xs"></i></div>
                      <div class="control-btn" onclick="openQuestionSettings('${questionId}')"><i class="fa-solid fa-gear fa-xs"></i></div>
                      <div class="control-btn" onclick="deleteQuestion('${questionId}')"><i class="fa-solid fa-trash fa-xs"></i></div>
                    </div>
                    <div class="question-preview">
                      <div class="question-text">${question.text}</div>
                      <div class="question-type">Ranking</div>
                      <div class="mt-2 space-y-2">
                        ${rankingHTML}
                      </div>
                    </div>
                  </div>
                `;
                break;
                
              case 'nps':
                questionHTML = `
                  <div class="canvas-item" data-type="nps" data-id="${questionId}" draggable="true" style="animation-delay: ${index * 0.05}s">
                    <div class="item-controls">
                      <div class="control-btn" onclick="editQuestion('${questionId}')"><i class="fa-solid fa-pen fa-xs"></i></div>
                      <div class="control-btn" onclick="openQuestionSettings('${questionId}')"><i class="fa-solid fa-gear fa-xs"></i></div>
                      <div class="control-btn" onclick="deleteQuestion('${questionId}')"><i class="fa-solid fa-trash fa-xs"></i></div>
                    </div>
                    <div class="question-preview">
                      <div class="question-text">${question.text}</div>
                      <div class="question-type">NPS Score</div>
                      <div class="mt-2">
                        <div class="flex justify-between text-sm mb-1">
                          <span>Not at all likely</span>
                          <span>Extremely likely</span>
                        </div>
                        <div class="flex justify-between">
                          ${[0,1,2,3,4,5,6,7,8,9,10].map(num => `
                            <div class="text-center">
                              <input type="radio" name="nps-${questionId}" disabled class="mx-auto">
                              <div class="text-xs mt-1">${num}</div>
                            </div>
                          `).join('')}
                        </div>
                      </div>
                    </div>
                  </div>
                `;
                break;
                
              default:
                questionHTML = `
                  <div class="canvas-item" data-type="${question.type}" data-id="${questionId}" draggable="true" style="animation-delay: ${index * 0.05}s">
                    <div class="item-controls">
                      <div class="control-btn" onclick="editQuestion('${questionId}')"><i class="fa-solid fa-pen fa-xs"></i></div>
                      <div class="control-btn" onclick="openQuestionSettings('${questionId}')"><i class="fa-solid fa-gear fa-xs"></i></div>
                      <div class="control-btn" onclick="deleteQuestion('${questionId}')"><i class="fa-solid fa-trash fa-xs"></i></div>
                    </div>
                    <div class="question-preview">
                      <div class="question-text">${question.text}</div>
                      <div class="question-type">${question.type.charAt(0).toUpperCase() + question.type.slice(1)} Question</div>
                      <div class="mt-2 text-sm text-ink-400">Question preview would appear here</div>
                    </div>
                  </div>
                `;
            }
            
            // Insert before the drop zone
            dropZone.insertAdjacentHTML('beforebegin', questionHTML);
          });
          
          // Hide drop zone if there are questions
          dropZone.classList.add('hidden');
        } else {
          // Show drop zone if no questions
          dropZone.classList.remove('hidden');
        }
      } else {
        // We are creating a new survey, so show the drop zone
        dropZone.classList.remove('hidden');
      }
    }
    
    function generatePreview() {
      const previewContent = $('#preview-content');
      previewContent.innerHTML = '';
      
      // Add survey title and description
      $('#preview-title').textContent = state.surveyData.title || 'Untitled Survey';
      $('#preview-description').textContent = state.surveyData.description || 'Survey description';
      
      // Add questions
      const questions = $$('#survey-canvas .canvas-item:not(#canvas-drop-zone)');
      questions.forEach((question, index) => {
        if (question.id === 'canvas-drop-zone') return;
        
        const type = question.dataset.type;
        const text = question.querySelector('.question-text').textContent;
        
        const questionElement = document.createElement('div');
        questionElement.className = 'survey-preview-question';
        
        const questionTitle = document.createElement('h3');
        questionTitle.className = 'survey-preview-question-title';
        questionTitle.textContent = `${index + 1}. ${text}`;
        questionElement.appendChild(questionTitle);
        
        // Add question-specific elements
        switch(type) {
          case 'text':
            const textInput = document.createElement('input');
            textInput.type = 'text';
            textInput.className = 'survey-preview-text-input';
            textInput.placeholder = 'Type your answer here';
            questionElement.appendChild(textInput);
            break;
            
          case 'multiple':
            const optionsContainer = document.createElement('div');
            optionsContainer.className = 'survey-preview-options';
            
            const options = question.querySelectorAll('.option-item label');
            options.forEach(option => {
              const optionDiv = document.createElement('div');
              optionDiv.className = 'survey-preview-option';
              
              const radio = document.createElement('input');
              radio.type = 'radio';
              radio.name = `question-${index}`;
              
              const label = document.createElement('label');
              label.textContent = option.textContent;
              
              optionDiv.appendChild(radio);
              optionDiv.appendChild(label);
              optionsContainer.appendChild(optionDiv);
            });
            
            questionElement.appendChild(optionsContainer);
            break;
            
          case 'checkbox':
            const checkboxContainer = document.createElement('div');
            checkboxContainer.className = 'survey-preview-options';
            
            const checkboxOptions = question.querySelectorAll('.option-item label');
            checkboxOptions.forEach(option => {
              const optionDiv = document.createElement('div');
              optionDiv.className = 'survey-preview-option';
              
              const checkbox = document.createElement('input');
              checkbox.type = 'checkbox';
              
              const label = document.createElement('label');
              label.textContent = option.textContent;
              
              optionDiv.appendChild(checkbox);
              optionDiv.appendChild(label);
              checkboxContainer.appendChild(optionDiv);
            });
            
            questionElement.appendChild(checkboxContainer);
            break;
            
          case 'dropdown':
            const select = document.createElement('select');
            select.className = 'survey-preview-text-input';
            
            const dropdownOptions = question.querySelectorAll('option');
            dropdownOptions.forEach(option => {
              const optionElement = document.createElement('option');
              optionElement.textContent = option.textContent;
              select.appendChild(optionElement);
            });
            
            questionElement.appendChild(select);
            break;
            
          case 'rating':
            const ratingContainer = document.createElement('div');
            ratingContainer.className = 'rating-container';
            
            for (let i = 1; i <= 5; i++) {
              const star = document.createElement('span');
              star.className = 'rating-star cursor-pointer';
              star.innerHTML = '<i class="fa-regular fa-star"></i>';
              
              star.addEventListener('click', () => {
                ratingContainer.querySelectorAll('.rating-star').forEach(s => {
                  s.innerHTML = '<i class="fa-regular fa-star"></i>';
                  s.classList.remove('active');
                });
                
                for (let j = 0; j < i; j++) {
                  ratingContainer.children[j].innerHTML = '<i class="fa-solid fa-star"></i>';
                  ratingContainer.children[j].classList.add('active');
                }
              });
              
              ratingContainer.appendChild(star);
            }
            
            questionElement.appendChild(ratingContainer);
            break;
            
          case 'date':
            const dateInput = document.createElement('input');
            dateInput.type = 'date';
            dateInput.className = 'survey-preview-text-input';
            questionElement.appendChild(dateInput);
            break;
            
          case 'scale':
            const scaleContainer = document.createElement('div');
            scaleContainer.className = 'scale-container';
            
            for (let i = 1; i <= 5; i++) {
              const scalePoint = document.createElement('div');
              scalePoint.className = 'scale-point';
              
              const radio = document.createElement('input');
              radio.type = 'radio';
              radio.name = `question-${index}`;
              
              const label = document.createElement('div');
              label.className = 'scale-label';
              label.textContent = i;
              
              scalePoint.appendChild(radio);
              scalePoint.appendChild(label);
              scaleContainer.appendChild(scalePoint);
            }
            
            questionElement.appendChild(scaleContainer);
            break;
            
          case 'file':
            const fileUpload = document.createElement('div');
            fileUpload.className = 'border-2 border-dashed border-white/20 rounded-lg p-6 text-center';
            fileUpload.innerHTML = `
              <i class="fa-solid fa-cloud-arrow-up text-2xl mb-2 text-primary-400"></i>
              <p class="text-sm">Drag and drop files here or click to browse</p>
              <button class="btn btn-ghost mt-2">Select Files</button>
            `;
            questionElement.appendChild(fileUpload);
            break;
            
          case 'section':
            const sectionDesc = document.createElement('p');
            sectionDesc.className = 'text-sm text-ink-400';
            sectionDesc.textContent = 'Section description goes here';
            questionElement.appendChild(sectionDesc);
            break;
            
          case 'matrix':
            const matrixTable = document.createElement('table');
            matrixTable.className = 'w-full text-sm';
            matrixTable.innerHTML = `
              <thead>
                <tr>
                  <th></th>
                  <th>Option 1</th>
                  <th>Option 2</th>
                  <th>Option 3</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td>Row 1</td>
                  <td><input type="radio" name="matrix-${index}-1"></td>
                  <td><input type="radio" name="matrix-${index}-1"></td>
                  <td><input type="radio" name="matrix-${index}-1"></td>
                </tr>
                <tr>
                  <td>Row 2</td>
                  <td><input type="radio" name="matrix-${index}-2"></td>
                  <td><input type="radio" name="matrix-${index}-2"></td>
                  <td><input type="radio" name="matrix-${index}-2"></td>
                </tr>
              </tbody>
            `;
            questionElement.appendChild(matrixTable);
            break;
            
          case 'ranking':
            const rankingContainer = document.createElement('div');
            rankingContainer.className = 'space-y-2';
            
            for (let i = 1; i <= 3; i++) {
              const rankingItem = document.createElement('div');
              rankingItem.className = 'flex items-center gap-2';
              rankingItem.innerHTML = `
                <span class="text-sm">${i}.</span>
                <input type="text" class="survey-preview-text-input" value="Option ${i}">
              `;
              rankingContainer.appendChild(rankingItem);
            }
            
            questionElement.appendChild(rankingContainer);
            break;
            
          case 'nps':
            const npsContainer = document.createElement('div');
            npsContainer.innerHTML = `
              <div class="flex justify-between text-sm mb-1">
                <span>Not at all likely</span>
                <span>Extremely likely</span>
              </div>
              <div class="flex justify-between">
                ${[0,1,2,3,4,5,6,7,8,9,10].map(num => `
                  <div class="text-center">
                    <input type="radio" name="nps-${index}" class="mx-auto">
                    <div class="text-xs mt-1">${num}</div>
                  </div>
                `).join('')}
              </div>
            `;
            questionElement.appendChild(npsContainer);
            break;
        }
        
        previewContent.appendChild(questionElement);
      });
    }

    // Render top surveys for dashboard
    function renderTopSurveys() {
      const container = $('#top-surveys');
      const topSurveys = [...state.surveys]
        .sort((a, b) => b.responses - a.responses)
        .slice(0, 3);
      
      if (topSurveys.length === 0) {
        container.innerHTML = `
          <div class="empty rounded-xl p-6 text-center">
            <i class="fa-solid fa-trophy text-3xl mb-3 opacity-50"></i>
            <p>No survey data available</p>
            <p class="text-xs mt-2">Create and share surveys to see performance metrics</p>
          </div>
        `;
        $('#badge-top-surveys').textContent = '0 items';
        return;
      }
      
      $('#badge-top-surveys').textContent = `${topSurveys.length} item${topSurveys.length>1?'s':''}`;
      
      container.innerHTML = topSurveys.map((survey, index) => `
        <div class="flex items-start gap-3 py-3 border-t border-white/5 first:border-t-0" style="animation-delay: ${index * 0.05}s">
          <div class="flex-1">
            <div class="font-medium">${escapeHtml(survey.title)}</div>
            <div class="text-sm text-ink-400">${survey.responses} responses • ${survey.completionRate}% completion</div>
          </div>
          <span class="badge status-${survey.status}">${survey.status}</span>
        </div>
      `).join('');
    }

    // Initialize drag and drop when builder is shown
    const observer = new MutationObserver(function(mutations) {
      mutations.forEach(function(mutation) {
        if (mutation.type === 'attributes' && mutation.attributeName === 'class') {
          if (!mutation.target.classList.contains('hidden')) {
            initDragAndDrop();
          }
        }
      });
    });

    observer.observe($('#route-builder'), { attributes: true });

    // Survey actions
    window.editSurvey = function(id) {
      const survey = state.surveys.find(s => s.id === id);
      if (survey) {
        // Set current survey id and title
        state.currentSurveyId = id;
        state.surveyData = {
          title: survey.title,
          description: survey.description,
          questions: survey.questions || []
        };
        
        // Navigate to builder
        showPageTransition(() => routeTo('builder'));
      }
    };

    window.shareSurvey = function(id) {
      const survey = state.surveys.find(s => s.id === id);
      if (survey) {
        // Set survey data for sharing
        state.surveyData = {
          title: survey.title,
          description: survey.description,
          questions: []
        };
        
        // Show share modal
        show('#share-survey-modal');
      }
    };

    window.duplicateSurvey = function(id) {
      const survey = state.surveys.find(s => s.id === id);
      if (survey) {
        // Create a duplicate of the survey
        const duplicate = {
          ...survey,
          id: Date.now(),
          title: `${survey.title} (Copy)`,
          status: "draft",
          responses: 0,
          completionRate: 0,
          createdAt: new Date().toISOString().split('T')[0],
          lastModified: new Date().toISOString().split('T')[0],
          questions: survey.questions ? [...survey.questions] : []
        };
        
        // Add to surveys array
        state.surveys.unshift(duplicate);
        
        // Re-render surveys
        renderSurveys('', state.currentFilter);
        
        // Show success message
        alert(`Survey "${survey.title}" has been duplicated.`);
        
        // Add activity
        state.activity.unshift({
          type: 'survey',
          title: `Duplicated "${survey.title}"`,
          time: 'Just now'
        });
        renderActivity();
      }
    };

    window.deleteSurvey = function(id) {
      const survey = state.surveys.find(s => s.id === id);
      if (survey && confirm(`Are you sure you want to delete "${survey.title}"?`)) {
        // Remove from surveys array
        state.surveys = state.surveys.filter(s => s.id !== id);
        
        // Re-render surveys
        renderSurveys('', state.currentFilter);
        
        // Update metrics
        window.APP.setMetrics({
          surveys: state.surveys.length,
          responses: state.metrics.responses,
          completion: state.metrics.completion,
          active: state.metrics.active
        });
        
        // Add activity
        state.activity.unshift({
          type: 'survey',
          title: `Deleted "${survey.title}"`,
          time: 'Just now'
        });
        renderActivity();
      }
    };

    // Edit Question functionality
    window.editQuestion = function(questionId) {
      const canvasItem = $(`.canvas-item[data-id="${questionId}"]`);
      if (!canvasItem) return;
      
      // Remove editing class from all questions
      $$('.canvas-item').forEach(item => {
        item.classList.remove('editing');
      });
      
      // Add editing class to current question
      canvasItem.classList.add('editing');
      
      // Get question data
      const type = canvasItem.dataset.type;
      const text = canvasItem.querySelector('.question-text').textContent;
      const description = canvasItem.querySelector('.question-description')?.textContent || '';
      const required = canvasItem.querySelector('input[required]') !== null;
      
      // Get options if applicable
      let options = [];
      if (type === 'multiple' || type === 'checkbox' || type === 'dropdown') {
        const optionLabels = canvasItem.querySelectorAll('.option-item label');
        options = Array.from(optionLabels).map(label => label.textContent);
      }
      
      // Set current editing question
      state.currentEditingQuestion = {
        id: questionId,
        type,
        text,
        description,
        required,
        options
      };
      
      // Populate edit form
      $('#edit-question-text').value = text;
      $('#edit-question-description').value = description;
      $('#edit-question-type').value = type;
      $('#edit-question-required').checked = required;
      
      // Show/hide options container based on question type
      const optionsContainer = $('#edit-options-container');
      if (type === 'multiple' || type === 'checkbox' || type === 'dropdown') {
        optionsContainer.style.display = 'block';
        
        // Clear existing options
        const optionsList = $('#edit-options-list');
        optionsList.innerHTML = '';
        
        // Add option fields
        options.forEach((option, index) => {
          addOptionField(option, index);
        });
      } else {
        optionsContainer.style.display = 'none';
      }
      
      // Show edit modal
      show('#edit-question-modal');
    };

    // Open Question Settings Panel
    window.openQuestionSettings = function(questionId) {
      const canvasItem = $(`.canvas-item[data-id="${questionId}"]`);
      if (!canvasItem) return;
      
      // Remove editing class from all questions
      $$('.canvas-item').forEach(item => {
        item.classList.remove('editing');
      });
      
      // Add editing class to current question
      canvasItem.classList.add('editing');
      
      // Set current editing question
      state.currentEditingQuestion = {
        id: questionId,
        type: canvasItem.dataset.type,
        text: canvasItem.querySelector('.question-text').textContent,
        description: canvasItem.querySelector('.question-description')?.textContent || '',
        required: canvasItem.querySelector('input[required]') !== null,
        options: []
      };
      
      // Populate settings form
      $('#settings-required').checked = state.questionSettings.required;
      $('#settings-shuffle').checked = state.questionSettings.shuffle;
      $('#settings-min-chars').value = state.questionSettings.minChars;
      $('#settings-max-chars').value = state.questionSettings.maxChars;
      $('#settings-layout').value = state.questionSettings.layout;
      $('#settings-logic').value = state.questionSettings.logic;
      
      // Show settings panel
      $('#question-settings').classList.add('active');
    };

    // Close Question Settings Panel
    window.closeQuestionSettings = function() {
      $('#question-settings').classList.remove('active');
    };

    // Apply Question Settings
    window.applyQuestionSettings = function() {
      // Update question settings
      state.questionSettings.required = $('#settings-required').checked;
      state.questionSettings.shuffle = $('#settings-shuffle').checked;
      state.questionSettings.minChars = parseInt($('#settings-min-chars').value) || 0;
      state.questionSettings.maxChars = parseInt($('#settings-max-chars').value) || 0;
      state.questionSettings.layout = $('#settings-layout').value;
      state.questionSettings.logic = $('#settings-logic').value;
      
      // Close settings panel
      $('#question-settings').classList.remove('active');
      
      // Show success message
      alert('Question settings applied successfully!');
    };

    function addOptionField(optionText = '', index = Date.now()) {
      const optionsList = $('#edit-options-list');
      
      const optionItem = document.createElement('div');
      optionItem.className = 'option-item';
      optionItem.dataset.index = index;
      
      optionItem.innerHTML = `
        <input type="text" class="field" value="${escapeHtml(optionText)}" placeholder="Enter option text" />
        <button type="button" onclick="removeOptionField(${index})">
          <i class="fa-solid fa-trash"></i>
        </button>
      `;
      
      optionsList.appendChild(optionItem);
    }

    function removeOptionField(index) {
      const optionItem = $(`.option-item[data-index="${index}"]`);
      if (optionItem) {
        optionItem.remove();
      }
    }

    function saveEditedQuestion() {
      const questionText = $('#edit-question-text').value.trim();
      const questionDescription = $('#edit-question-description').value.trim();
      const questionRequired = $('#edit-question-required').checked;
      
      // Get options if applicable
      let options = [];
      const type = $('#edit-question-type').value;
      
      if (type === 'multiple' || type === 'checkbox' || type === 'dropdown') {
        const optionInputs = $$('#edit-options-list input[type="text"]');
        options = Array.from(optionInputs)
          .map(input => input.value.trim())
          .filter(value => value !== '');
      }
      
      // Update question data
      const updatedQuestion = {
        ...state.currentEditingQuestion,
        text: questionText,
        description: questionDescription,
        required: questionRequired,
        options
      };
      
      // Update canvas item
      updateCanvasItem(updatedQuestion);
      
      // Update survey data
      if (state.currentSurveyId) {
        const survey = state.surveys.find(s => s.id === state.currentSurveyId);
        if (survey) {
          const questionIndex = survey.questions.findIndex(q => q.id === state.currentEditingQuestion.id);
          if (questionIndex !== -1) {
            survey.questions[questionIndex] = updatedQuestion;
          }
        }
      } else {
        // Update in current survey data
        const questionIndex = state.surveyData.questions.findIndex(q => q.id === state.currentEditingQuestion.id);
        if (questionIndex !== -1) {
          state.surveyData.questions[questionIndex] = updatedQuestion;
        }
      }
      
      // Close modal
      hide('#edit-question-modal');
      
      // Remove editing class
      $(`.canvas-item[data-id="${state.currentEditingQuestion.id}"]`).classList.remove('editing');
    }

    function updateCanvasItem(question) {
      const canvasItem = $(`.canvas-item[data-id="${question.id}"]`);
      if (!canvasItem) return;
      
      // Update question text
      const questionTextElement = canvasItem.querySelector('.question-text');
      if (questionTextElement) {
        questionTextElement.textContent = question.text;
      }
      
      // Update question description
      let questionDescElement = canvasItem.querySelector('.question-description');
      if (questionDescElement) {
        questionDescElement.textContent = question.description;
      } else if (question.description) {
        // Create description element if it doesn't exist
        questionDescElement = document.createElement('p');
        questionDescElement.className = 'question-description';
        questionDescElement.textContent = question.description;
        
        const questionContent = canvasItem.querySelector('.question-content');
        if (questionContent) {
          questionContent.appendChild(questionDescElement);
        }
      }
      
      // Update options if applicable
      if (question.type === 'multiple' || question.type === 'checkbox' || question.type === 'dropdown') {
        const optionsContainer = canvasItem.querySelector('.space-y-2, .options-list');
        if (optionsContainer) {
          optionsContainer.innerHTML = '';
          
          question.options.forEach((option, index) => {
            const optionDiv = document.createElement('div');
            optionDiv.className = 'flex items-center gap-2';
            
            if (question.type === 'multiple') {
              optionDiv.innerHTML = `
                <input type="radio" disabled class="rounded-full">
                <label class="text-sm">${escapeHtml(option)}</label>
              `;
            } else if (question.type === 'checkbox') {
              optionDiv.innerHTML = `
                <input type="checkbox" disabled class="rounded">
                <label class="text-sm">${escapeHtml(option)}</label>
              `;
            } else if (question.type === 'dropdown') {
              // For dropdown, we need to update the select element
              const selectElement = canvasItem.querySelector('select');
              if (selectElement) {
                const optionElement = document.createElement('option');
                optionElement.textContent = option;
                selectElement.appendChild(optionElement);
              }
              return;
            }
            
            optionsContainer.appendChild(optionDiv);
          });
        }
      }
    }

    window.deleteQuestion = function(id) {
      if (confirm('Are you sure you want to delete this question?')) {
        const canvasItem = $(`.canvas-item[data-id="${id}"]`);
        if (canvasItem) {
          canvasItem.style.animation = 'fade-in-up 0.3s reverse';
          setTimeout(() => {
            canvasItem.remove();
            
            // Show drop zone if no questions left
            const canvas = $('#survey-canvas');
            const dropZone = $('#canvas-drop-zone');
            if (canvas.querySelectorAll('.canvas-item:not(#canvas-drop-zone)').length === 0) {
              dropZone.classList.remove('hidden');
            }
            
            // Remove from survey data
            if (state.currentSurveyId) {
              const survey = state.surveys.find(s => s.id === state.currentSurveyId);
              if (survey) {
                survey.questions = survey.questions.filter(q => q.id !== id);
              }
            } else {
              state.surveyData.questions = state.surveyData.questions.filter(q => q.id !== id);
            }
          }, 300);
        }
      }
    };

    // Helpers
    function show(s){ $(s).classList.remove('hidden'); }
    function hide(s){ $(s).classList.add('hidden'); }

    // KPI render ("--" when empty)
    function renderKpis(){
      $('#kpi-surveys').textContent   = numberOrDash(state.metrics.surveys);
      $('#kpi-responses').textContent = numberOrDash(state.metrics.responses);
      $('#kpi-completion').textContent= percentOrDash(state.metrics.completion);
      $('#kpi-active').textContent    = numberOrDash(state.metrics.active);
      
      // Update progress bar
      if (state.metrics.completion !== null) {
        $('#completion-progress').style.width = `${state.metrics.completion}%`;
      }
    }
    const numberOrDash = v => (v===0 || v>0) ? String(v) : '--';
    const percentOrDash = v => (v===0 || v>0) ? `${v}%` : '--';

    // Activity render
    function renderActivity(){
      const wrap = $('#activity');
      if(!state.activity.length){
        wrap.innerHTML = '<div class="empty rounded-xl p-6 text-center"><i class="fa-solid fa-bell text-3xl mb-3 opacity-50"></i><p>No activity yet</p><p class="text-xs mt-2">Your recent actions will appear here</p></div>';
        $('#badge-activity').textContent = '0 items';
        return;
      }
      $('#badge-activity').textContent = `${state.activity.length} item${state.activity.length>1?'s':''}`;
      wrap.innerHTML = state.activity.map((a, index) => `
        <div class="flex items-start gap-3 py-3 border-t border-white/5 first:border-t-0" style="animation-delay: ${index * 0.05}s">
          <span class="badge">${escapeHtml(a.type||'event')}</span>
          <div class="text-sm">
            <div>${escapeHtml(a.title||'')}</div>
            <div class="text-ink-500">${escapeHtml(a.time||'')}</div>
          </div>
        </div>`).join('');
    }

    // Charts render (only when data provided)
    function ensureCharts(){
      // initialize canvases once
      const ctxR = document.getElementById('chart-responses').getContext('2d');
      const ctxS = document.getElementById('chart-status').getContext('2d');
      if(!state.charts.responses){ state.charts.responses = new Chart(ctxR, { type:'line', data:{ labels:[], datasets:[] }, options: baseLineOpts() }); }
      if(!state.charts.status){ state.charts.status = new Chart(ctxS, { type:'doughnut', data:{ labels:[], datasets:[] }, options: baseDoughnutOpts() }); }
      // show placeholders until user injects series
      toggleEmpty('#empty-responses', state.charts.responses.data.datasets.length===0);
      toggleEmpty('#empty-status', state.charts.status.data.datasets.length===0);
    }

    function renderLine(canvasSel, emptySel, cfg){
      ensureCharts();
      const ch = state.charts.responses;
      ch.data.labels = Array.isArray(cfg?.labels)? cfg.labels : [];
      ch.data.datasets = Array.isArray(cfg?.datasets)? cfg.datasets : [];
      ch.update();
      toggleEmpty(emptySel, ch.data.datasets.length===0);
    }
    function renderDoughnut(canvasSel, emptySel, cfg){
      ensureCharts();
      const ch = state.charts.status;
      ch.data.labels = Array.isArray(cfg?.labels)? cfg.labels : [];
      ch.data.datasets = Array.isArray(cfg?.datasets)? cfg.datasets : [];
      ch.update();
      toggleEmpty(emptySel, ch.data.datasets.length===0);
    }

    const baseLineOpts = () => ({
      responsive:true, maintainAspectRatio:false,
      plugins:{ legend:{ display:false } },
      scales:{ x:{ grid:{ color:'rgba(255,255,255,.06)' }, ticks:{ color:'rgba(229,231,235,.8)'}}, y:{ beginAtZero:true, grid:{ color:'rgba(255,255,255,.06)' }, ticks:{ color:'rgba(229,231,235,.8)'}}}
    });
    const baseDoughnutOpts = () => ({
      responsive:true, maintainAspectRatio:false,
      plugins:{ legend:{ position:'bottom', labels:{ color:'rgba(229,231,235,.8)'} } }
    });

    function toggleEmpty(sel, shouldShow){
      const el = document.querySelector(sel); if(!el) return; el.classList.toggle('hidden', !shouldShow);
    }
    function escapeHtml(str){
      return String(str||'').replace(/[&<>'"]/g, c => ({'&':'&amp;','<':'&lt;','>':'&gt;','\'':'&#39;','"':'&quot;'}[c]));
    }

    // Switch auth tabs
    function switchAuth(which){
      const isLogin = which === 'login';
      $('#tab-login').setAttribute('data-active', isLogin);
      $('#tab-signup').setAttribute('data-active', !isLogin);
      $('#form-login').classList.toggle('hidden', !isLogin);
      $('#form-signup').classList.toggle('hidden', isLogin);
    }
  </script>
</body>
</html>